<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - RFID Attendance</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script>
        // Configure Tailwind for dark mode
        tailwind.config = {
            darkMode: 'media',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            50: '#f8fafc',
                            100: '#f1f5f9',
                            200: '#e2e8f0',
                            300: '#cbd5e1',
                            400: '#94a3b8',
                            500: '#64748b',
                            600: '#475569',
                            700: '#334155',
                            800: '#1e293b',
                            900: '#0f172a'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        .sidebar-item:hover {
            background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%);
        }
        .card-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
        .dark .card-gradient {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
        }
        .status-entry { color: #10b981; }
        .status-exit { color: #f59e0b; }
        .status-late { color: #ef4444; }
        
        /* Mobile optimizations */
        @media (max-width: 768px) {
            .mobile-scroll {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }
            .mobile-text {
                font-size: 0.875rem;
            }
            .mobile-padding {
                padding: 1rem;
            }
        }
        
        /* Dark mode chart styles */
        .dark canvas {
            filter: brightness(0.9);
        }
        
        /* Smooth transitions */
        * {
            transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease;
        }
        
        /* Custom scrollbar for dark mode */
        .dark ::-webkit-scrollbar {
            width: 8px;
        }
        .dark ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        .dark ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        .dark ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-dark-900 font-sans min-h-screen transition-colors duration-200">
    <!-- Header -->
    <header class="bg-white dark:bg-dark-800 shadow-sm border-b border-gray-200 dark:border-dark-700 fixed w-full top-0 z-50">
        <div class="flex items-center justify-between px-4 sm:px-6 py-3 sm:py-4">
            <div class="flex items-center space-x-2 sm:space-x-4">
                <button id="sidebarToggle" class="lg:hidden text-gray-600 dark:text-dark-300 hover:text-gray-900 dark:hover:text-white p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-dark-700">
                    <i class="fas fa-bars text-lg sm:text-xl"></i>
                </button>
                <div class="flex items-center space-x-2 sm:space-x-3">
                    <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/CHAITANYA_SHREE_LOGO666_2_dc873305-f464-4839-9a1f-231a4aaa168e.png?v=1758454694" 
                         alt="Chaitanya Shree Academy Logo" 
                         class="h-8 w-8 sm:h-10 sm:w-10 object-contain"
                         onerror="this.style.display='none';">
                    <div class="hidden sm:block">
                        <h1 class="text-lg sm:text-xl font-bold text-gray-900 dark:text-white">Chaitanya Shree Academy</h1>
                        <p class="text-xs sm:text-sm text-gray-600 dark:text-dark-300">RFID Attendance Management</p>
                    </div>
                    <div class="sm:hidden">
                        <h1 class="text-sm font-bold text-gray-900 dark:text-white">CSA</h1>
                        <p class="text-xs text-gray-600 dark:text-dark-300">RFID System</p>
                    </div>
                </div>
            </div>
            <div class="flex items-center space-x-2 sm:space-x-4">
                <div class="hidden md:block text-xs sm:text-sm text-gray-600 dark:text-dark-300">
                    <span id="currentDate"></span>
                </div>
                <button id="logoutButton" class="flex items-center space-x-1 sm:space-x-2 px-2 sm:px-3 py-2 text-gray-600 dark:text-dark-300 hover:text-red-600 dark:hover:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200" title="Logout">
                    <i class="fas fa-sign-out-alt text-sm"></i>
                    <span class="hidden sm:inline text-sm">Logout</span>
                </button>
                <div class="w-7 h-7 sm:w-8 sm:h-8 bg-white rounded-full flex items-center justify-center p-1 border-2 border-blue-200">
                    <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/CHAITANYA_SHREE_LOGO666_2_dc873305-f464-4839-9a1f-231a4aaa168e.png?v=1758454694" 
                         alt="Admin Profile" 
                         class="w-full h-full object-contain rounded-full"
                         onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\'fas fa-user-shield text-blue-600 text-xs sm:text-sm\'></i>';">
                </div>
            </div>
        </div>
    </header>

    <!-- Sidebar -->
    <aside id="sidebar" class="fixed left-0 top-14 sm:top-16 h-full w-64 bg-white dark:bg-dark-800 shadow-lg transform -translate-x-full lg:translate-x-0 transition-transform duration-300 z-40 border-r border-gray-200 dark:border-dark-700">
        <nav class="p-3 sm:p-4 space-y-1 sm:space-y-2">
            <a href="#" data-view="dashboard" class="sidebar-item flex items-center space-x-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg bg-blue-600 text-white transition-all duration-200" onclick="showView('dashboard'); return false;">
                <i class="fas fa-chart-pie text-sm sm:text-base"></i>
                <span class="text-sm sm:text-base">Dashboard</span>
            </a>
            <a href="#" data-view="attendance" class="sidebar-item flex items-center space-x-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-gray-700 dark:text-dark-300 hover:text-white transition-all duration-200" onclick="showView('attendance'); return false;">
                <i class="fas fa-clipboard-list text-sm sm:text-base"></i>
                <span class="text-sm sm:text-base">Attendance Records</span>
            </a>
            <a href="#" data-view="students" class="sidebar-item flex items-center space-x-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-gray-700 dark:text-dark-300 hover:text-white transition-all duration-200" onclick="showView('students'); return false;">
                <i class="fas fa-users text-sm sm:text-base"></i>
                <span class="text-sm sm:text-base">Students</span>
            </a>
            <a href="#" data-view="reports" class="sidebar-item flex items-center space-x-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-gray-700 dark:text-dark-300 hover:text-white transition-all duration-200" onclick="showView('reports'); return false;">
                <i class="fas fa-chart-bar text-sm sm:text-base"></i>
                <span class="text-sm sm:text-base">Reports</span>
            </a>
            <a href="#" data-view="settings" class="sidebar-item flex items-center space-x-3 px-3 sm:px-4 py-2 sm:py-3 rounded-lg text-gray-700 dark:text-dark-300 hover:text-white transition-all duration-200" onclick="showView('settings'); return false;">
                <i class="fas fa-cog text-sm sm:text-base"></i>
                <span class="text-sm sm:text-base">Settings</span>
            </a>
        </nav>
    </aside>

    <!-- Main Content -->
    <main class="lg:ml-64 pt-14 sm:pt-16 min-h-screen">
        <!-- Dashboard View -->
        <div id="dashboardView" class="p-3 sm:p-4 lg:p-6">
            <!-- Dashboard Cards -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-3 sm:gap-4 lg:gap-6 mb-6 sm:mb-8">
                <div class="card-gradient rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Total Students</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold text-blue-600 dark:text-blue-400" data-stat="total">1,247</p>
                        </div>
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-users text-blue-600 dark:text-blue-400 text-lg sm:text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="card-gradient rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Present Today</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold text-green-600 dark:text-green-400" data-stat="present">1,089</p>
                        </div>
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-check-circle text-green-600 dark:text-green-400 text-lg sm:text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="card-gradient rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Absent Today</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold text-red-600 dark:text-red-400" data-stat="absent">158</p>
                        </div>
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-times-circle text-red-600 dark:text-red-400 text-lg sm:text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="card-gradient rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Late Entries</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold text-orange-600 dark:text-orange-400" data-stat="late">23</p>
                        </div>
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-clock text-orange-600 dark:text-orange-400 text-lg sm:text-xl"></i>
                        </div>
                    </div>
                </div>

                <div class="card-gradient rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Early Exits</p>
                            <p class="text-xl sm:text-2xl lg:text-3xl font-bold text-purple-600 dark:text-purple-400" data-stat="early">7</p>
                        </div>
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-sign-out-alt text-purple-600 dark:text-purple-400 text-lg sm:text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6 sm:mb-8">
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">Daily Attendance Percentage</h3>
                    <div style="height: 250px; position: relative;" class="sm:h-[300px]">
                        <canvas id="dailyChart"></canvas>
                    </div>
                </div>
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">Monthly Trends</h3>
                    <div style="height: 250px; position: relative;" class="sm:h-[300px]">
                        <canvas id="monthlyChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Filters and Search -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex flex-col space-y-4">
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                        <input type="date" id="dateFilter" class="px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <input type="text" id="nameFilter" placeholder="Search by student name..." class="px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white dark:placeholder-dark-400 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <select id="statusFilter" class="px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                            <option value="">All Status</option>
                            <option value="entry">Entry</option>
                            <option value="exit">Exit</option>
                            <option value="absent">Absent</option>
                        </select>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                        <button id="refreshData" class="px-3 sm:px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh Data</span>
                        </button>
                        <button id="exportCSV" class="px-3 sm:px-4 py-2 bg-green-600 dark:bg-green-500 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-file-csv"></i>
                            <span class="hidden sm:inline">Export CSV</span>
                            <span class="sm:hidden">CSV</span>
                        </button>
                        <button id="exportPDF" class="px-3 sm:px-4 py-2 bg-red-600 dark:bg-red-500 text-white rounded-lg hover:bg-red-700 dark:hover:bg-red-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-file-pdf"></i>
                            <span class="hidden sm:inline">Export PDF</span>
                            <span class="sm:hidden">PDF</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- End of Day Report -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-0">End of Day Report</h3>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                        <input type="date" id="reportDate" class="px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <button id="generateDayReport" class="px-3 sm:px-4 py-2 bg-purple-600 dark:bg-purple-500 text-white rounded-lg hover:bg-purple-700 dark:hover:bg-purple-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-chart-line"></i>
                            <span>Generate Report</span>
                        </button>
                    </div>
                </div>
                
                <div id="dayReportContent" class="hidden">
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6">
                        <!-- Students with Entry Only -->
                        <div class="bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-sm font-semibold text-orange-800 dark:text-orange-300">Entry Only (No Exit)</h4>
                                <span id="entryOnlyCount" class="bg-orange-100 dark:bg-orange-900/40 text-orange-800 dark:text-orange-300 px-2 py-1 rounded-full text-xs font-bold">0</span>
                            </div>
                            <div id="entryOnlyList" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Students with entry only will be listed here -->
                            </div>
                        </div>
                        
                        <!-- Students with Complete Attendance -->
                        <div class="bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-sm font-semibold text-green-800 dark:text-green-300">Complete Attendance</h4>
                                <span id="completeAttendanceCount" class="bg-green-100 dark:bg-green-900/40 text-green-800 dark:text-green-300 px-2 py-1 rounded-full text-xs font-bold">0</span>
                            </div>
                            <div id="completeAttendanceList" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Students with complete attendance will be listed here -->
                            </div>
                        </div>
                        
                        <!-- Students with No Entry -->
                        <div class="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="text-sm font-semibold text-red-800 dark:text-red-300">No Entry (Absent)</h4>
                                <span id="noEntryCount" class="bg-red-100 dark:bg-red-900/40 text-red-800 dark:text-red-300 px-2 py-1 rounded-full text-xs font-bold">0</span>
                            </div>
                            <div id="noEntryList" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Students with no entry will be listed here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 dark:bg-dark-700 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-sm font-semibold text-gray-900 dark:text-white">Report Summary</h4>
                            <button id="exportDayReport" class="px-3 py-1 bg-blue-600 dark:bg-blue-500 text-white rounded text-xs hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors">
                                <i class="fas fa-download mr-1"></i>Export
                            </button>
                        </div>
                        <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
                            <div>
                                <div class="text-lg font-bold text-gray-900 dark:text-white" id="totalStudentsReport">0</div>
                                <div class="text-xs text-gray-600 dark:text-dark-300">Total Students</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-green-600 dark:text-green-400" id="presentStudentsReport">0</div>
                                <div class="text-xs text-gray-600 dark:text-dark-300">Present</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-orange-600 dark:text-orange-400" id="incompleteStudentsReport">0</div>
                                <div class="text-xs text-gray-600 dark:text-dark-300">Incomplete</div>
                            </div>
                            <div>
                                <div class="text-lg font-bold text-red-600 dark:text-red-400" id="absentStudentsReport">0</div>
                                <div class="text-xs text-gray-600 dark:text-dark-300">Absent</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="noDayReportGenerated" class="text-center py-8 text-gray-500 dark:text-dark-400">
                    <i class="fas fa-chart-line text-4xl mb-3 opacity-50"></i>
                    <p class="text-sm">Select a date and click "Generate Report" to view end-of-day attendance summary</p>
                </div>
            </div>

            <!-- Individual Student Summary -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-0">Individual Student Summary</h3>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                        <select id="studentSelect" class="px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                            <option value="">Select a student...</option>
                        </select>
                        <select id="summaryPeriod" class="px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                            <option value="week">This Week</option>
                            <option value="month">This Month</option>
                            <option value="all">All Time</option>
                        </select>
                    </div>
                </div>
                
                <div id="studentSummaryContent" class="hidden">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                        <div class="bg-blue-50 dark:bg-blue-900/20 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs sm:text-sm font-medium text-blue-600 dark:text-blue-400">Total Days</p>
                                    <p class="text-xl sm:text-2xl font-bold text-blue-700 dark:text-blue-300" id="summaryTotalDays">0</p>
                                </div>
                                <i class="fas fa-calendar text-blue-500 text-lg"></i>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs sm:text-sm font-medium text-green-600 dark:text-green-400">Present Days</p>
                                    <p class="text-xl sm:text-2xl font-bold text-green-700 dark:text-green-300" id="summaryPresentDays">0</p>
                                </div>
                                <i class="fas fa-check-circle text-green-500 text-lg"></i>
                            </div>
                        </div>
                        
                        <div class="bg-red-50 dark:bg-red-900/20 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs sm:text-sm font-medium text-red-600 dark:text-red-400">Absent Days</p>
                                    <p class="text-xl sm:text-2xl font-bold text-red-700 dark:text-red-300" id="summaryAbsentDays">0</p>
                                </div>
                                <i class="fas fa-times-circle text-red-500 text-lg"></i>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 dark:bg-purple-900/20 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="text-xs sm:text-sm font-medium text-purple-600 dark:text-purple-400">Attendance %</p>
                                    <p class="text-xl sm:text-2xl font-bold text-purple-700 dark:text-purple-300" id="summaryAttendancePercent">0%</p>
                                </div>
                                <i class="fas fa-chart-pie text-purple-500 text-lg"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-gray-50 dark:bg-dark-700 rounded-lg p-4">
                            <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3">Recent Activity</h4>
                            <div id="studentRecentActivity" class="space-y-2 max-h-48 overflow-y-auto">
                                <!-- Recent activity will be populated here -->
                            </div>
                        </div>
                        
                        <div class="bg-gray-50 dark:bg-dark-700 rounded-lg p-4">
                            <h4 class="text-sm font-semibold text-gray-900 dark:text-white mb-3">Attendance Pattern</h4>
                            <div id="studentAttendancePattern" class="space-y-2">
                                <!-- Attendance pattern will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="noStudentSelected" class="text-center py-8 text-gray-500 dark:text-dark-400">
                    <i class="fas fa-user-graduate text-4xl mb-3 opacity-50"></i>
                    <p class="text-sm">Select a student to view their attendance summary</p>
                </div>
            </div>

            <!-- Attendance Table -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 overflow-hidden">
                <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-dark-700 flex flex-col sm:flex-row sm:items-center justify-between space-y-3 sm:space-y-0">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">Recent Attendance Records</h3>
                    <div class="flex items-center space-x-3 sm:space-x-4">
                        <div id="loadingIndicator" class="hidden flex items-center space-x-2 text-blue-600 dark:text-blue-400">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span class="text-xs sm:text-sm">Loading...</span>
                        </div>
                        <button id="addAttendanceRecord" class="px-3 sm:px-4 py-2 bg-green-600 dark:bg-green-500 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 transition-colors duration-200 flex items-center space-x-2 text-sm">
                            <i class="fas fa-plus"></i>
                            <span class="hidden sm:inline">Add Record</span>
                            <span class="sm:hidden">Add</span>
                        </button>
                    </div>
                </div>
                <div class="overflow-x-auto mobile-scroll">
                    <table class="w-full min-w-full">
                        <thead class="bg-gray-50 dark:bg-dark-700">
                            <tr>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors duration-200" onclick="sortTable('name')" id="nameHeader">
                                    <div class="flex items-center space-x-1">
                                        <span>Name</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="nameSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors duration-200 hidden sm:table-cell" onclick="sortTable('uid')" id="uidHeader">
                                    <div class="flex items-center space-x-1">
                                        <span>UID</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="uidSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors duration-200" onclick="sortTable('date')" id="dateHeader">
                                    <div class="flex items-center space-x-1">
                                        <span>Date</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="dateSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors duration-200" onclick="sortTable('time')" id="timeHeader">
                                    <div class="flex items-center space-x-1">
                                        <span>Time</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="timeSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors duration-200" onclick="sortTable('status')" id="statusHeader">
                                    <div class="flex items-center space-x-1">
                                        <span>Status</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="statusSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="attendanceTable" class="bg-white dark:bg-dark-800 divide-y divide-gray-200 dark:divide-dark-700">
                            <!-- Table rows will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Attendance Records View -->
        <div id="attendanceView" class="p-3 sm:p-4 lg:p-6" style="display: none;">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">Detailed Attendance Records</h2>
            
            <!-- Filters for Attendance Records -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">From Date</label>
                        <input type="date" id="attendanceFromDate" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">To Date</label>
                        <input type="date" id="attendanceToDate" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Student Name</label>
                        <input type="text" id="attendanceNameFilter" placeholder="Search by name..." class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white dark:placeholder-dark-400 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Status</label>
                        <select id="attendanceStatusFilter" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                            <option value="">All Status</option>
                            <option value="entry">Entry</option>
                            <option value="exit">Exit</option>
                            <option value="absent">Absent</option>
                        </select>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 mt-4">
                    <button id="applyAttendanceFilters" class="px-3 sm:px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                        <i class="fas fa-filter"></i>
                        <span>Apply Filters</span>
                    </button>
                    <button id="clearAttendanceFilters" class="px-3 sm:px-4 py-2 bg-gray-600 dark:bg-gray-500 text-white rounded-lg hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                        <i class="fas fa-times"></i>
                        <span>Clear</span>
                    </button>
                    <button id="exportAttendanceRecords" class="px-3 sm:px-4 py-2 bg-green-600 dark:bg-green-500 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                        <i class="fas fa-file-excel"></i>
                        <span>Export</span>
                    </button>
                </div>
            </div>
            
            <!-- Attendance Statistics -->
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Total Records</p>
                            <p class="text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-400" id="totalAttendanceRecords">0</p>
                        </div>
                        <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-list text-blue-600 dark:text-blue-400"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Entry Records</p>
                            <p class="text-xl sm:text-2xl font-bold text-green-600 dark:text-green-400" id="totalEntryRecords">0</p>
                        </div>
                        <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-sign-in-alt text-green-600 dark:text-green-400"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Exit Records</p>
                            <p class="text-xl sm:text-2xl font-bold text-orange-600 dark:text-orange-400" id="totalExitRecords">0</p>
                        </div>
                        <div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-sign-out-alt text-orange-600 dark:text-orange-400"></i>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Unique Students</p>
                            <p class="text-xl sm:text-2xl font-bold text-purple-600 dark:text-purple-400" id="uniqueStudentsCount">0</p>
                        </div>
                        <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-users text-purple-600 dark:text-purple-400"></i>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Attendance Records Table -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 overflow-hidden">
                <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-dark-700 flex flex-col sm:flex-row sm:items-center justify-between space-y-3 sm:space-y-0">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">Attendance Records</h3>
                    <div class="flex items-center space-x-3">
                        <span class="text-xs sm:text-sm text-gray-600 dark:text-dark-300" id="recordsCount">Showing 0 records</span>
                        <div id="attendanceLoadingIndicator" class="hidden flex items-center space-x-2 text-blue-600 dark:text-blue-400">
                            <i class="fas fa-spinner fa-spin"></i>
                            <span class="text-xs sm:text-sm">Loading...</span>
                        </div>
                    </div>
                </div>
                <div class="overflow-x-auto mobile-scroll">
                    <table class="w-full min-w-full">
                        <thead class="bg-gray-50 dark:bg-dark-700">
                            <tr>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600" onclick="sortAttendanceTable('date')">
                                    <div class="flex items-center space-x-1">
                                        <span>Date</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="attendanceDateSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600" onclick="sortAttendanceTable('name')">
                                    <div class="flex items-center space-x-1">
                                        <span>Student Name</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="attendanceNameSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600" onclick="sortAttendanceTable('time')">
                                    <div class="flex items-center space-x-1">
                                        <span>Time</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="attendanceTimeSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600" onclick="sortAttendanceTable('status')">
                                    <div class="flex items-center space-x-1">
                                        <span>Status</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="attendanceStatusSort"></i>
                                    </div>
                                </th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider hidden sm:table-cell">UID</th>
                                <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fullAttendanceTable" class="bg-white dark:bg-dark-800 divide-y divide-gray-200 dark:divide-dark-700">
                            <!-- Full attendance records will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Students View -->
        <div id="studentsView" class="p-3 sm:p-4 lg:p-6" style="display: none;">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">Students Management</h2>
            
            <!-- Add Student Form -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6 mb-4 sm:mb-6">
                <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">Add New Student</h3>
                <form id="addStudentForm" class="space-y-3 sm:space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Student Name *</label>
                            <input type="text" id="studentName" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white dark:placeholder-dark-400 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" placeholder="Enter student full name">
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Student ID (Optional)</label>
                            <input type="text" id="studentId" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white dark:placeholder-dark-400 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" placeholder="Enter student ID">
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 sm:gap-4">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Class/Grade</label>
                            <input type="text" id="studentClass" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white dark:placeholder-dark-400 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" placeholder="Enter class or grade">
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Status</label>
                            <select id="studentStatus" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                                <option value="Active">Active</option>
                                <option value="Inactive">Inactive</option>
                            </select>
                        </div>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                        <button type="submit" class="px-4 sm:px-6 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-plus"></i>
                            <span>Add Student</span>
                        </button>
                        <button type="button" id="refreshStudents" class="px-4 sm:px-6 py-2 bg-gray-600 dark:bg-gray-500 text-white rounded-lg hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-sync-alt"></i>
                            <span>Refresh List</span>
                        </button>
                    </div>
                </form>
                <div id="addStudentMessage" class="mt-4 hidden"></div>
            </div>

            <!-- Students Statistics -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-6">
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600 dark:text-dark-300">Total Students</p>
                            <p class="text-3xl font-bold text-blue-600 dark:text-blue-400" id="totalStudentsCount">0</p>
                        </div>
                        <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-users text-blue-600 dark:text-blue-400 text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600 dark:text-dark-300">Active Students</p>
                            <p class="text-3xl font-bold text-green-600 dark:text-green-400" id="activeStudentsCount">0</p>
                        </div>
                        <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-user-check text-green-600 dark:text-green-400 text-xl"></i>
                        </div>
                    </div>
                </div>
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-6">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-sm font-medium text-gray-600 dark:text-dark-300">New This Month</p>
                            <p class="text-3xl font-bold text-purple-600 dark:text-purple-400" id="newStudentsCount">0</p>
                        </div>
                        <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                            <i class="fas fa-user-plus text-purple-600 dark:text-purple-400 text-xl"></i>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Students List -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200 dark:border-dark-700 flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Students List</h3>
                    <div id="studentsLoadingIndicator" class="hidden flex items-center space-x-2 text-blue-600 dark:text-blue-400">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span class="text-sm">Loading...</span>
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead class="bg-gray-50 dark:bg-dark-700">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors duration-200" onclick="sortStudentsTable('name')" id="studentNameHeader">
                                    <div class="flex items-center space-x-1">
                                        <span>Name</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="studentNameSort"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors duration-200" onclick="sortStudentsTable('studentId')" id="studentIdHeader">
                                    <div class="flex items-center space-x-1">
                                        <span>Student ID</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="studentIdSort"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider cursor-pointer hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors duration-200" onclick="sortStudentsTable('class')" id="studentClassHeader">
                                    <div class="flex items-center space-x-1">
                                        <span>Class/Grade</span>
                                        <i class="fas fa-sort text-gray-400 dark:text-dark-400" id="studentClassSort"></i>
                                    </div>
                                </th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Date Added</th>
                            </tr>
                        </thead>
                        <tbody id="studentsTable" class="bg-white dark:bg-dark-800 divide-y divide-gray-200 dark:divide-dark-700">
                            <!-- Students will be populated by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reports View -->
        <div id="reportsView" class="p-3 sm:p-4 lg:p-6" style="display: none;">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">Reports & Analytics</h2>
            
            <!-- Report Type Selection -->
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6 mb-4 sm:mb-6">
                <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4">
                    <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-0">Generate Reports</h3>
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                        <select id="reportType" class="px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                            <option value="weekly">Weekly Report</option>
                            <option value="monthly">Monthly Report</option>
                            <option value="custom">Custom Date Range</option>
                        </select>
                        <button id="generateReport" class="px-3 sm:px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-chart-bar"></i>
                            <span>Generate</span>
                        </button>
                    </div>
                </div>
                
                <!-- Custom Date Range (hidden by default) -->
                <div id="customDateRange" class="hidden grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mt-4">
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">From Date</label>
                        <input type="date" id="reportFromDate" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                    </div>
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">To Date</label>
                        <input type="date" id="reportToDate" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                    </div>
                </div>
            </div>
            
            <!-- Report Content -->
            <div id="reportContent" class="hidden">
                <!-- Report Header -->
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6 mb-4 sm:mb-6">
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4">
                        <div>
                            <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white" id="reportTitle">Report</h3>
                            <p class="text-xs sm:text-sm text-gray-600 dark:text-dark-300" id="reportPeriod">Period: -</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 mt-3 sm:mt-0">
                            <button id="exportReportPDF" class="px-3 sm:px-4 py-2 bg-red-600 dark:bg-red-500 text-white rounded-lg hover:bg-red-700 dark:hover:bg-red-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                                <i class="fas fa-file-pdf"></i>
                                <span>Export PDF</span>
                            </button>
                            <button id="exportReportCSV" class="px-3 sm:px-4 py-2 bg-green-600 dark:bg-green-500 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                                <i class="fas fa-file-csv"></i>
                                <span>Export CSV</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Report Statistics -->
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Total Days</p>
                                <p class="text-xl sm:text-2xl font-bold text-blue-600 dark:text-blue-400" id="reportTotalDays">0</p>
                            </div>
                            <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-calendar text-blue-600 dark:text-blue-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Avg Attendance</p>
                                <p class="text-xl sm:text-2xl font-bold text-green-600 dark:text-green-400" id="reportAvgAttendance">0%</p>
                            </div>
                            <div class="w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-percentage text-green-600 dark:text-green-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Total Records</p>
                                <p class="text-xl sm:text-2xl font-bold text-purple-600 dark:text-purple-400" id="reportTotalRecords">0</p>
                            </div>
                            <div class="w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-list text-purple-600 dark:text-purple-400"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs sm:text-sm font-medium text-gray-600 dark:text-dark-300">Peak Day</p>
                                <p class="text-xl sm:text-2xl font-bold text-orange-600 dark:text-orange-400" id="reportPeakDay">-</p>
                            </div>
                            <div class="w-10 h-10 bg-orange-100 dark:bg-orange-900/30 rounded-lg flex items-center justify-center">
                                <i class="fas fa-trophy text-orange-600 dark:text-orange-400"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Report Charts -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6">
                    <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                        <h4 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">Daily Attendance Trend</h4>
                        <div style="height: 250px; position: relative;" class="sm:h-[300px]">
                            <canvas id="reportTrendChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                        <h4 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">Status Distribution</h4>
                        <div style="height: 250px; position: relative;" class="sm:h-[300px]">
                            <canvas id="reportDistributionChart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Top Performers -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 mb-6">
                    <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                        <h4 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">Top Performers (Best Attendance)</h4>
                        <div id="topPerformers" class="space-y-3">
                            <!-- Top performers will be populated here -->
                        </div>
                    </div>
                    <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                        <h4 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">Needs Attention (Low Attendance)</h4>
                        <div id="needsAttention" class="space-y-3">
                            <!-- Students needing attention will be populated here -->
                        </div>
                    </div>
                </div>
                
                <!-- Detailed Report Table -->
                <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 overflow-hidden">
                    <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-dark-700">
                        <h4 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">Detailed Student Report</h4>
                    </div>
                    <div class="overflow-x-auto mobile-scroll">
                        <table class="w-full min-w-full">
                            <thead class="bg-gray-50 dark:bg-dark-700">
                                <tr>
                                    <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Student Name</th>
                                    <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Class</th>
                                    <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Present Days</th>
                                    <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Absent Days</th>
                                    <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Late Entries</th>
                                    <th class="px-3 sm:px-6 py-2 sm:py-3 text-left text-xs font-medium text-gray-500 dark:text-dark-300 uppercase tracking-wider">Attendance %</th>
                                </tr>
                            </thead>
                            <tbody id="reportDetailTable" class="bg-white dark:bg-dark-800 divide-y divide-gray-200 dark:divide-dark-700">
                                <!-- Detailed report data will be populated here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- No Report Generated -->
            <div id="noReportGenerated" class="text-center py-12 text-gray-500 dark:text-dark-400">
                <i class="fas fa-chart-bar text-6xl mb-4 opacity-50"></i>
                <h3 class="text-lg font-medium mb-2">No Report Generated</h3>
                <p class="text-sm">Select a report type and click "Generate" to view detailed analytics</p>
            </div>
        </div>

        <!-- Settings View -->
        <div id="settingsView" class="p-3 sm:p-4 lg:p-6" style="display: none;">
            <h2 class="text-xl sm:text-2xl font-bold text-gray-900 dark:text-white mb-4 sm:mb-6">Settings</h2>
            <div class="bg-white dark:bg-dark-800 rounded-xl shadow-sm border border-gray-100 dark:border-dark-700 p-4 sm:p-6">
                <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white mb-3 sm:mb-4">College Timing Configuration</h3>
                <div class="space-y-4 sm:space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">College Start Time</label>
                            <input type="time" id="collegeStartTime" value="08:30" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                            <p class="text-xs text-gray-500 dark:text-dark-400 mt-1">Official college start time</p>
                        </div>
                        <div>
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">College End Time</label>
                            <input type="time" id="collegeEndTime" value="17:00" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                            <p class="text-xs text-gray-500 dark:text-dark-400 mt-1">Official college end time (4:30 PM)</p>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Late Entry Threshold</label>
                        <input type="time" id="lateThreshold" value="09:00" class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm max-w-xs">
                        <p class="text-xs text-gray-500 dark:text-dark-400 mt-1">Students entering after this time will be marked as late</p>
                    </div>
                    
                    <div class="bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4">
                        <h4 class="text-sm font-semibold text-blue-800 dark:text-blue-300 mb-2">Current College Schedule</h4>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 text-xs sm:text-sm">
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-clock text-blue-600 dark:text-blue-400"></i>
                                <span class="text-gray-700 dark:text-dark-300">Start: <strong>8:30 AM</strong></span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-clock text-blue-600 dark:text-blue-400"></i>
                                <span class="text-gray-700 dark:text-dark-300">End: <strong>4:30 PM</strong></span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <i class="fas fa-exclamation-triangle text-orange-600 dark:text-orange-400"></i>
                                <span class="text-gray-700 dark:text-dark-300">Late after: <strong>9:00 AM</strong></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                        <button id="saveSettings" class="px-4 sm:px-6 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-save"></i>
                            <span>Save Settings</span>
                        </button>
                        <button id="resetSettings" class="px-4 sm:px-6 py-2 bg-gray-600 dark:bg-gray-500 text-white rounded-lg hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                            <i class="fas fa-undo"></i>
                            <span>Reset to Default</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Overlay for mobile sidebar -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-30 lg:hidden hidden"></div>

    <!-- Edit Attendance Modal -->
    <div id="editAttendanceModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-3 sm:p-4">
        <div class="bg-white dark:bg-dark-800 rounded-xl shadow-xl max-w-md w-full mx-3 sm:mx-0">
            <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-dark-700">
                <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">Edit Attendance Record</h3>
            </div>
            <form id="editAttendanceForm" class="p-4 sm:p-6 space-y-3 sm:space-y-4">
                <input type="hidden" id="editRecordIndex">
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Student Name *</label>
                    <input type="text" id="editStudentName" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                </div>
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Date *</label>
                    <input type="date" id="editDate" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                </div>
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Time *</label>
                    <input type="time" id="editTime" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                </div>
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Status *</label>
                    <select id="editStatus" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <option value="entry">Entry</option>
                        <option value="exit">Exit</option>
                        <option value="absent">Absent</option>
                    </select>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 pt-3 sm:pt-4">
                    <button type="submit" class="px-3 sm:px-4 py-2 bg-blue-600 dark:bg-blue-500 text-white rounded-lg hover:bg-blue-700 dark:hover:bg-blue-600 transition-colors duration-200 text-sm">
                        Update Record
                    </button>
                    <button type="button" id="cancelEdit" class="px-3 sm:px-4 py-2 bg-gray-600 dark:bg-gray-500 text-white rounded-lg hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors duration-200 text-sm">
                        Cancel
                    </button>
                    <button type="button" id="deleteRecord" class="px-3 sm:px-4 py-2 bg-red-600 dark:bg-red-500 text-white rounded-lg hover:bg-red-700 dark:hover:bg-red-600 transition-colors duration-200 text-sm">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </form>
            <div id="editAttendanceMessage" class="px-4 sm:px-6 pb-4 sm:pb-6 hidden"></div>
        </div>
    </div>

    <!-- Add Attendance Modal -->
    <div id="addAttendanceModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-3 sm:p-4">
        <div class="bg-white dark:bg-dark-800 rounded-xl shadow-xl max-w-md w-full mx-3 sm:mx-0">
            <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-dark-700">
                <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white">Add Attendance Record</h3>
            </div>
            <form id="addAttendanceForm" class="p-4 sm:p-6 space-y-3 sm:space-y-4">
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Student Name *</label>
                    <input type="text" id="addStudentName" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white dark:placeholder-dark-400 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm" placeholder="Enter student name">
                </div>
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Date *</label>
                    <input type="date" id="addDate" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                </div>
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Time *</label>
                    <input type="time" id="addTime" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                </div>
                <div>
                    <label class="block text-xs sm:text-sm font-medium text-gray-700 dark:text-dark-300 mb-2">Status *</label>
                    <select id="addStatus" required class="w-full px-3 sm:px-4 py-2 border border-gray-300 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
                        <option value="entry">Entry</option>
                        <option value="exit">Exit</option>
                        <option value="absent">Absent</option>
                    </select>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 pt-3 sm:pt-4">
                    <button type="submit" class="px-3 sm:px-4 py-2 bg-green-600 dark:bg-green-500 text-white rounded-lg hover:bg-green-700 dark:hover:bg-green-600 transition-colors duration-200 text-sm">
                        Add Record
                    </button>
                    <button type="button" id="cancelAdd" class="px-3 sm:px-4 py-2 bg-gray-600 dark:bg-gray-500 text-white rounded-lg hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors duration-200 text-sm">
                        Cancel
                    </button>
                </div>
            </form>
            <div id="addAttendanceMessage" class="px-4 sm:px-6 pb-4 sm:pb-6 hidden"></div>
        </div>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-3 sm:p-4">
        <div class="bg-white dark:bg-dark-800 rounded-xl shadow-xl max-w-md w-full mx-3 sm:mx-0">
            <div class="px-4 sm:px-6 py-3 sm:py-4 border-b border-gray-200 dark:border-dark-700">
                <h3 class="text-base sm:text-lg font-semibold text-gray-900 dark:text-white flex items-center">
                    <i class="fas fa-sign-out-alt text-red-500 dark:text-red-400 mr-2"></i>
                    Confirm Logout
                </h3>
            </div>
            <div class="p-4 sm:p-6">
                <p class="text-gray-600 dark:text-dark-300 mb-4 sm:mb-6 text-sm sm:text-base">Are you sure you want to logout? You'll need to enter your password again to access the dashboard.</p>
                <div class="flex flex-col sm:flex-row gap-2 sm:gap-3">
                    <button id="confirmLogout" class="px-3 sm:px-4 py-2 bg-red-600 dark:bg-red-500 text-white rounded-lg hover:bg-red-700 dark:hover:bg-red-600 transition-colors duration-200 flex items-center justify-center space-x-2 text-sm">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Yes, Logout</span>
                    </button>
                    <button id="cancelLogout" class="px-3 sm:px-4 py-2 bg-gray-600 dark:bg-gray-500 text-white rounded-lg hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors duration-200 text-sm">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-50 flex items-center justify-center p-3 sm:p-4" style="background-image: url('https://cdn.shopify.com/s/files/1/0685/1900/2265/files/media-and-entertainment-minimal-4-middle.jpg?v=1750587750'); background-size: cover; background-position: center; background-repeat: no-repeat;">
        <div class="absolute inset-0 bg-black bg-opacity-40 backdrop-blur-sm"></div>
        <div class="bg-white dark:bg-dark-800 rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative z-10 mx-3 sm:mx-0">
            <!-- Header with Logo/Brand -->
            <div class="relative px-4 sm:px-8 py-6 sm:py-8 text-center overflow-hidden" style="background-image: url('https://cdn.shopify.com/s/files/1/0685/1900/2265/files/Blue_Modern_School_Admission_Banner_Landscape.png?v=1758456492'); background-size: cover; background-position: center; background-repeat: no-repeat; min-height: 160px;">
                <div class="absolute inset-0 bg-black bg-opacity-30"></div>
                <div class="relative z-10">
                    <div class="w-12 h-12 sm:w-16 sm:h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-3 sm:mb-4 p-2">
                        <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/CHAITANYA_SHREE_LOGO666_2_dc873305-f464-4839-9a1f-231a4aaa168e.png?v=1758454694" 
                             alt="Chaitanya Shree Academy Logo" 
                             class="w-full h-full object-contain"
                             onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\'fas fa-shield-alt text-white text-xl sm:text-2xl\'></i>';">
                    </div>
                    <h2 class="text-lg sm:text-2xl font-bold text-white mb-1 sm:mb-2 drop-shadow-lg">Chaitanya Shree Academy</h2>
                    <p class="text-white text-xs sm:text-sm drop-shadow-md">RFID Attendance Management System</p>
                </div>
            </div>
            
            <!-- Login Form -->
            <div class="px-4 sm:px-8 py-6 sm:py-8">
                <div class="text-center mb-4 sm:mb-6">
                    <h3 class="text-lg sm:text-xl font-semibold text-gray-800 dark:text-white mb-2">Administrator Login</h3>
                    <p class="text-gray-600 dark:text-dark-300 text-xs sm:text-sm">Please enter your credentials to continue</p>
                </div>
                
                <form id="loginForm" class="space-y-4 sm:space-y-6">
                    <div>
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-dark-300 mb-2 sm:mb-3">Username</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 sm:pl-4 flex items-center pointer-events-none">
                                <i class="fas fa-user text-gray-400 dark:text-dark-400 text-sm"></i>
                            </div>
                            <input type="text" id="adminUsername" required 
                                   class="w-full pl-10 sm:pl-12 pr-3 sm:pr-4 py-3 sm:py-4 border-2 border-gray-200 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-gray-800 dark:placeholder-dark-400 placeholder-gray-400 text-sm sm:text-base" 
                                   placeholder="Enter your username">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs sm:text-sm font-semibold text-gray-700 dark:text-dark-300 mb-2 sm:mb-3">Password</label>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 sm:pl-4 flex items-center pointer-events-none">
                                <i class="fas fa-lock text-gray-400 dark:text-dark-400 text-sm"></i>
                            </div>
                            <input type="password" id="adminPassword" required 
                                   class="w-full pl-10 sm:pl-12 pr-3 sm:pr-4 py-3 sm:py-4 border-2 border-gray-200 dark:border-dark-600 dark:bg-dark-700 dark:text-white rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all duration-200 text-gray-800 dark:placeholder-dark-400 placeholder-gray-400 text-sm sm:text-base" 
                                   placeholder="Enter your password">
                        </div>
                    </div>
                    

                    
                    <button type="submit" class="w-full bg-gradient-to-r from-yellow-300 to-yellow-400 text-gray-800 py-3 sm:py-4 px-4 sm:px-6 rounded-xl font-semibold text-sm sm:text-lg hover:from-yellow-400 hover:to-yellow-500 focus:outline-none focus:ring-4 focus:ring-yellow-200 transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98]">
                        <i class="fas fa-sign-in-alt mr-2"></i>
                        Access Dashboard
                    </button>
                    
                    <div id="loginError" class="hidden p-3 sm:p-4 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-400 rounded-xl text-xs sm:text-sm text-center">
                        <i class="fas fa-exclamation-triangle mr-2"></i>
                        Invalid credentials. Please check your password and try again.
                    </div>
                </form>
                
                <!-- Footer -->
                <div class="mt-6 sm:mt-8 pt-4 sm:pt-6 border-t border-gray-200 dark:border-dark-700 text-center">
                    <p class="text-xs text-gray-500 dark:text-dark-400 mb-2 sm:mb-3">
                        <i class="fas fa-shield-alt mr-1"></i>
                        Secured by advanced authentication
                    </p>
                    <div class="flex items-center justify-center space-x-2">
                        <span class="text-xs text-gray-400 dark:text-dark-400">Powered by</span>
                        <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/Black_and_Red_Dragon_Gaming_Company_Logo_5.png?v=1758258967" 
                             alt="Sohan Soft Tech Logo" 
                             class="h-3 w-3 sm:h-4 sm:w-4 object-contain"
                             onerror="this.style.display='none';">
                        <a href="https://www.sohansoft.tech" target="_blank" rel="noopener noreferrer" class="text-xs text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 transition-colors">
                            Sohan Soft Tech
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Super Admin Configuration
        const SUPER_ADMIN_USERNAME = 'csa-2025';
        const SUPER_ADMIN_PASSWORD = 'Sohan@2211';
        
        // Google Sheets Configuration
        const SHEET_ID = '1fgGbEfMvOE9x__PsWK_B57ZGOyDVAr-_nEP5g1VpO3o';
        const API_KEY = 'AIzaSyBc_wRljKa9Cr8pDWMip_AnfMXcLsbPvV8';
        const SHEET_NAME = 'Attendance';
        
        // Sample data (fallback if Google Sheets is not configured)
        let attendanceData = [
            { name: "Keerthana S", uid: "2F93CA2E", date: "2025-09-23", time: "08:30", status: "entry" },
            { name: "Harshavardhan", uid: "FF74782F", date: "2025-09-23", time: "08:25", status: "entry" },
            { name: "Siri G", uid: "1D7D46F0", date: "2025-09-23", time: "08:45", status: "entry" },
            { name: "Rumana", uid: "1DC139F0", date: "2025-09-23", time: "08:35", status: "entry" },
            { name: "Suprith J", uid: "DFC0712F", date: "2025-09-23", time: "17:30", status: "exit" },
            { name: "Swati Singh", uid: "5D0834F0", date: "2025-09-23", time: "08:40", status: "entry" },
            { name: "Thanu Dharmesh", uid: "8F9F152F", date: "2025-09-23", time: "17:15", status: "exit" },
            { name: "Manushree V", uid: "CD5456EF", date: "2025-09-23", time: "08:20", status: "entry" },
            { name: "Bindhu Shree K", uid: "3D07F1EF", date: "2025-09-23", time: "08:50", status: "entry" },
            { name: "Deekshitha S G", uid: "0D43DBF0", date: "2025-09-23", time: "17:00", status: "exit" },
            { name: "Leka Priya", uid: "7DE5F3EF", date: "2025-09-23", time: "08:55", status: "entry" },
            { name: "Gowthami M", uid: "8D90F8F0", date: "2025-09-23", time: "17:20", status: "exit" }
        ];

        let filteredData = [...attendanceData];
        let studentsData = [];

        // Function to fetch students data from Google Sheets
        async function fetchStudentsData() {
            try {
                console.log('🔄 Fetching students data from Google Sheets...');
                
                // Fetch data from both sheets
                const [class11AResponse, class11BResponse] = await Promise.all([
                    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/11th A?key=${API_KEY}`),
                    fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/11th B?key=${API_KEY}`)
                ]);
                
                if (!class11AResponse.ok || !class11BResponse.ok) {
                    throw new Error(`HTTP error! 11th A status: ${class11AResponse.status}, 11th B status: ${class11BResponse.status}`);
                }
                
                const [class11AData, class11BData] = await Promise.all([
                    class11AResponse.json(),
                    class11BResponse.json()
                ]);
                
                let allStudents = [];
                
                // Process 11th A students
                if (class11AData.values && class11AData.values.length > 1) {
                    const class11AStudents = class11AData.values.slice(1).map(row => {
                        return {
                            name: row[1] || '', // Student's Name (2nd column)
                            studentId: row[0] || '', // UID (1st column)
                            class: "11th A",
                            status: "Active",
                            dateAdded: "2025-09-22"
                        };
                    }).filter(student => student.name && student.studentId);
                    
                    allStudents = allStudents.concat(class11AStudents);
                    console.log(`✅ Loaded ${class11AStudents.length} students from 11th A sheet`);
                }
                
                // Process 11th B students
                if (class11BData.values && class11BData.values.length > 1) {
                    const class11BStudents = class11BData.values.slice(1).map(row => {
                        return {
                            name: row[1] || '', // Student's Name (2nd column)
                            studentId: row[0] || '', // UID (1st column)
                            class: "11th B",
                            status: "Active",
                            dateAdded: "2025-09-22"
                        };
                    }).filter(student => student.name && student.studentId);
                    
                    allStudents = allStudents.concat(class11BStudents);
                    console.log(`✅ Loaded ${class11BStudents.length} students from 11th B sheet`);
                }
                
                if (allStudents.length === 0) {
                    console.log('⚠️ No students data found in Google Sheets. Using fallback data.');
                    return getSampleStudentsData();
                }
                
                console.log(`🎓 Total students loaded: ${allStudents.length}`);
                return allStudents;
                
            } catch (error) {
                console.error('❌ Error fetching students data from Google Sheets:', error);
                console.log('🔄 Using fallback sample data.');
                return getSampleStudentsData();
            }
        }

        // Function to get sample students data (fallback only)
        function getSampleStudentsData() {
            console.log('📝 Using sample student data as fallback');
            return [
                // Sample data for testing when Google Sheets is not available
                { name: "Sample Student A1", studentId: "SAMPLE001", class: "11th A", status: "Active", dateAdded: "2025-09-22" },
                { name: "Sample Student A2", studentId: "SAMPLE002", class: "11th A", status: "Active", dateAdded: "2025-09-22" },
                { name: "Sample Student B1", studentId: "SAMPLE003", class: "11th B", status: "Active", dateAdded: "2025-09-22" },
                { name: "Sample Student B2", studentId: "SAMPLE004", class: "11th B", status: "Active", dateAdded: "2025-09-22" }
            ];
        }

        // Function to add student to Google Sheets using Apps Script Web App
        async function addStudentToSheet(studentData) {
            try {
                // Create Google Apps Script Web App URL (you need to deploy this)
                const webAppUrl = 'https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec';
                
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors', // Required for Google Apps Script
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addStudent',
                        sheetId: SHEET_ID,
                        data: [
                            studentData.name,
                            studentData.studentId,
                            studentData.class,
                            studentData.status,
                            studentData.dateAdded
                        ]
                    })
                });
                
                // Since we're using no-cors, we can't read the response
                // But we'll assume success and add to local data
                studentsData.push(studentData);
                
                return { 
                    success: true, 
                    message: 'Student added to Google Sheets successfully! (Refresh to see changes from other tabs)' 
                };
                
            } catch (error) {
                console.error('Error adding student to Google Sheets:', error);
                
                // Fallback: Add to local data only
                studentsData.push(studentData);
                return { 
                    success: true, 
                    message: 'Student added locally. To sync with Google Sheets, set up the Web App integration.' 
                };
            }
        }

        // Function to update attendance record in Google Sheets
        async function updateAttendanceRecord(index, recordData) {
            try {
                const webAppUrl = 'https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec';
                
                // Format timestamp for Google Sheets
                const timestamp = `${recordData.date} ${recordData.time}:00`;
                
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'updateAttendance',
                        sheetId: SHEET_ID,
                        rowIndex: index + 2, // +2 for header row and 1-based indexing
                        data: [timestamp, recordData.name, recordData.status]
                    })
                });
                
                // Update local data for immediate display
                attendanceData[index] = recordData;
                filteredData = [...attendanceData];
                
                return { 
                    success: true, 
                    message: 'Attendance record updated in Google Sheets! (Refresh to see changes from other tabs)' 
                };
                
            } catch (error) {
                console.error('Error updating attendance record in Google Sheets:', error);
                
                // Fallback: Update local data only
                attendanceData[index] = recordData;
                filteredData = [...attendanceData];
                return { 
                    success: true, 
                    message: 'Record updated locally. To sync with Google Sheets, set up the Web App integration.' 
                };
            }
        }

        // Function to add new attendance record to Google Sheets
        async function addAttendanceRecord(recordData) {
            try {
                const webAppUrl = 'https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec';
                
                // Format timestamp for Google Sheets
                const timestamp = `${recordData.date} ${recordData.time}:00`;
                
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addAttendance',
                        sheetId: SHEET_ID,
                        data: [timestamp, recordData.name, recordData.status]
                    })
                });
                
                // Add to local data for immediate display
                attendanceData.unshift(recordData);
                filteredData = [...attendanceData];
                
                return { 
                    success: true, 
                    message: 'Attendance record added to Google Sheets! (Refresh to see changes from other tabs)' 
                };
                
            } catch (error) {
                console.error('Error adding attendance record to Google Sheets:', error);
                
                // Fallback: Add to local data only
                attendanceData.unshift(recordData);
                filteredData = [...attendanceData];
                return { 
                    success: true, 
                    message: 'Record added locally. To sync with Google Sheets, set up the Web App integration.' 
                };
            }
        }

        // Function to delete attendance record from Google Sheets
        async function deleteAttendanceRecord(index) {
            try {
                const webAppUrl = 'https://script.google.com/macros/s/YOUR_WEB_APP_ID/exec';
                
                const response = await fetch(webAppUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'deleteAttendance',
                        sheetId: SHEET_ID,
                        rowIndex: index + 2 // +2 for header row and 1-based indexing
                    })
                });
                
                // Remove from local data for immediate display
                attendanceData.splice(index, 1);
                filteredData = [...attendanceData];
                
                return { 
                    success: true, 
                    message: 'Attendance record deleted from Google Sheets! (Refresh to see changes from other tabs)' 
                };
                
            } catch (error) {
                console.error('Error deleting attendance record from Google Sheets:', error);
                
                // Fallback: Remove from local data only
                attendanceData.splice(index, 1);
                filteredData = [...attendanceData];
                return { 
                    success: true, 
                    message: 'Record deleted locally. To sync with Google Sheets, set up the Web App integration.' 
                };
            }
        }

        // Function to populate student dropdown
        function populateStudentDropdown() {
            const studentSelect = document.getElementById('studentSelect');
            if (!studentSelect) return;
            
            // Clear existing options except the first one
            studentSelect.innerHTML = '<option value="">Select a student...</option>';
            
            // Add students to dropdown
            studentsData.forEach(student => {
                const option = document.createElement('option');
                option.value = student.name;
                option.textContent = `${student.name} (${student.class})`;
                studentSelect.appendChild(option);
            });
        }

        // Function to calculate student summary
        function calculateStudentSummary(studentName, period) {
            if (!studentName) return null;
            
            // Calculate date range based on period
            const today = new Date();
            let startDate;
            
            switch (period) {
                case 'week':
                    startDate = new Date(today);
                    startDate.setDate(today.getDate() - 7);
                    break;
                case 'month':
                    startDate = new Date(today);
                    startDate.setMonth(today.getMonth() - 1);
                    break;
                case 'all':
                default:
                    startDate = new Date('2025-09-22'); // Start of academic year (student join date)
                    break;
            }
            
            const startDateStr = startDate.toISOString().split('T')[0];
            const todayStr = today.toISOString().split('T')[0];
            
            // Get student's attendance records in the period
            const studentRecords = attendanceData.filter(record => 
                record.name === studentName && 
                record.date >= startDateStr && 
                record.date <= todayStr
            );
            
            // Calculate unique dates with entries
            const datesWithEntry = new Set();
            const datesWithAbsence = new Set();
            const recentActivity = [];
            
            studentRecords.forEach(record => {
                if (record.status === 'entry') {
                    datesWithEntry.add(record.date);
                } else if (record.status === 'absent') {
                    datesWithAbsence.add(record.date);
                }
                
                // Add to recent activity (last 10 records)
                recentActivity.push({
                    date: record.date,
                    time: record.time,
                    status: record.status
                });
            });
            
            // Sort recent activity by date and time (most recent first)
            recentActivity.sort((a, b) => {
                const dateTimeA = new Date(`${a.date}T${a.time}`);
                const dateTimeB = new Date(`${b.date}T${b.time}`);
                return dateTimeB - dateTimeA;
            });
            
            // Calculate working days in the period (excluding weekends)
            let workingDays = 0;
            const currentDate = new Date(startDate);
            while (currentDate <= today) {
                const dayOfWeek = currentDate.getDay();
                if (dayOfWeek !== 0 && dayOfWeek !== 6) { // Not Sunday or Saturday
                    workingDays++;
                }
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            const presentDays = datesWithEntry.size;
            const absentDays = datesWithAbsence.size;
            const attendancePercent = workingDays > 0 ? Math.round((presentDays / workingDays) * 100) : 0;
            
            return {
                totalDays: workingDays,
                presentDays: presentDays,
                absentDays: absentDays,
                attendancePercent: attendancePercent,
                recentActivity: recentActivity.slice(0, 10), // Last 10 activities
                period: period
            };
        }

        // Function to display student summary
        function displayStudentSummary(summary) {
            if (!summary) {
                document.getElementById('studentSummaryContent').classList.add('hidden');
                document.getElementById('noStudentSelected').classList.remove('hidden');
                return;
            }
            
            document.getElementById('noStudentSelected').classList.add('hidden');
            document.getElementById('studentSummaryContent').classList.remove('hidden');
            
            // Update summary cards
            document.getElementById('summaryTotalDays').textContent = summary.totalDays;
            document.getElementById('summaryPresentDays').textContent = summary.presentDays;
            document.getElementById('summaryAbsentDays').textContent = summary.absentDays;
            document.getElementById('summaryAttendancePercent').textContent = summary.attendancePercent + '%';
            
            // Update recent activity
            const recentActivityDiv = document.getElementById('studentRecentActivity');
            recentActivityDiv.innerHTML = '';
            
            if (summary.recentActivity.length === 0) {
                recentActivityDiv.innerHTML = '<p class="text-xs text-gray-500 dark:text-dark-400">No recent activity found</p>';
            } else {
                summary.recentActivity.forEach(activity => {
                    const activityDiv = document.createElement('div');
                    activityDiv.className = 'flex items-center justify-between py-2 px-3 bg-white dark:bg-dark-800 rounded border';
                    
                    let statusClass, statusIcon;
                    if (activity.status === 'entry') {
                        statusClass = 'text-green-600 dark:text-green-400';
                        statusIcon = 'fa-sign-in-alt';
                    } else if (activity.status === 'exit') {
                        statusClass = 'text-orange-600 dark:text-orange-400';
                        statusIcon = 'fa-sign-out-alt';
                    } else {
                        statusClass = 'text-red-600 dark:text-red-400';
                        statusIcon = 'fa-times-circle';
                    }
                    
                    activityDiv.innerHTML = `
                        <div class="flex items-center space-x-2">
                            <i class="fas ${statusIcon} ${statusClass} text-xs"></i>
                            <span class="text-xs font-medium capitalize">${activity.status}</span>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-dark-400">
                            ${activity.date} ${activity.time}
                        </div>
                    `;
                    
                    recentActivityDiv.appendChild(activityDiv);
                });
            }
            
            // Update attendance pattern
            const patternDiv = document.getElementById('studentAttendancePattern');
            patternDiv.innerHTML = '';
            
            // Calculate weekly pattern
            const weeklyPattern = calculateWeeklyPattern(summary);
            weeklyPattern.forEach(day => {
                const dayDiv = document.createElement('div');
                dayDiv.className = 'flex items-center justify-between py-2 px-3 bg-white dark:bg-dark-800 rounded border';
                
                const attendanceRate = day.total > 0 ? Math.round((day.present / day.total) * 100) : 0;
                let rateClass = 'text-gray-600';
                if (attendanceRate >= 90) rateClass = 'text-green-600 dark:text-green-400';
                else if (attendanceRate >= 70) rateClass = 'text-yellow-600 dark:text-yellow-400';
                else rateClass = 'text-red-600 dark:text-red-400';
                
                dayDiv.innerHTML = `
                    <span class="text-xs font-medium">${day.name}</span>
                    <span class="text-xs ${rateClass}">${attendanceRate}% (${day.present}/${day.total})</span>
                `;
                
                patternDiv.appendChild(dayDiv);
            });
        }

        // Function to calculate weekly attendance pattern
        function calculateWeeklyPattern(summary) {
            const days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            const pattern = days.map(day => ({ name: day, present: 0, total: 0 }));
            
            // This is a simplified calculation - you can enhance based on actual data
            // For now, we'll show equal distribution
            const avgPresent = Math.floor(summary.presentDays / 6);
            const avgTotal = Math.floor(summary.totalDays / 6);
            
            pattern.forEach(day => {
                day.present = avgPresent;
                day.total = avgTotal;
            });
            
            return pattern;
        }

        // Event listeners for student summary
        function initializeStudentSummary() {
            const studentSelect = document.getElementById('studentSelect');
            const summaryPeriod = document.getElementById('summaryPeriod');
            
            if (studentSelect && summaryPeriod) {
                const updateSummary = () => {
                    const selectedStudent = studentSelect.value;
                    const selectedPeriod = summaryPeriod.value;
                    
                    if (selectedStudent) {
                        const summary = calculateStudentSummary(selectedStudent, selectedPeriod);
                        displayStudentSummary(summary);
                    } else {
                        displayStudentSummary(null);
                    }
                };
                
                studentSelect.addEventListener('change', updateSummary);
                summaryPeriod.addEventListener('change', updateSummary);
            }
        }

        // Function to populate students table
        function populateStudentsTable(data) {
            const tableBody = document.getElementById('studentsTable');
            tableBody.innerHTML = '';

            data.forEach(student => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-dark-700';
                
                const statusClass = student.status === 'Active' ? 'text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/30' : 'text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/30';
                
                row.innerHTML = `
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900 dark:text-white">${student.name}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${student.studentId}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${student.class}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm">
                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">
                            ${student.status}
                        </span>
                    </td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${student.dateAdded}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Function to update students statistics
        function updateStudentsStats() {
            const totalStudents = studentsData.length;
            const activeStudents = studentsData.filter(s => s.status === 'Active').length;
            
            // Calculate new students this month
            const currentMonth = new Date().getMonth();
            const currentYear = new Date().getFullYear();
            const newThisMonth = studentsData.filter(s => {
                const studentDate = new Date(s.dateAdded);
                return studentDate.getMonth() === currentMonth && studentDate.getFullYear() === currentYear;
            }).length;
            
            document.getElementById('totalStudentsCount').textContent = totalStudents;
            document.getElementById('activeStudentsCount').textContent = activeStudents;
            document.getElementById('newStudentsCount').textContent = newThisMonth;
        }

        // Function to refresh students data
        async function refreshStudentsData() {
            const loadingIndicator = document.getElementById('studentsLoadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.classList.remove('hidden');
            }
            
            try {
                studentsData = await fetchStudentsData();
                populateStudentsTable(studentsData);
                updateStudentsStats();
                populateStudentDropdown(); // Update the dropdown for individual summary
            } catch (error) {
                console.error('Error refreshing students data:', error);
            } finally {
                if (loadingIndicator) {
                    loadingIndicator.classList.add('hidden');
                }
            }
        }

        // Function to fetch data from Google Sheets
        async function fetchGoogleSheetsData() {
            console.log('🔄 Attempting to fetch attendance data from Google Sheets...');
            console.log('📋 Sheet ID:', SHEET_ID);
            console.log('🔑 API Key configured:', API_KEY ? 'Yes' : 'No');
            
            try {
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
                console.log('🌐 Fetching from URL:', url);
                
                const response = await fetch(url);
                console.log('📡 Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('❌ HTTP Error Response:', errorText);
                    throw new Error(`HTTP error! status: ${response.status} - ${errorText}`);
                }
                
                const data = await response.json();
                console.log('📊 Raw Google Sheets response:', data);
                
                const rows = data.values;
                
                if (!rows || rows.length <= 1) {
                    console.log('⚠️ No data rows found in Google Sheets. Row count:', rows ? rows.length : 0);
                    if (rows && rows.length === 1) {
                        console.log('📋 Header row found:', rows[0]);
                    }
                    return attendanceData; // Return sample data as fallback
                }
                
                console.log(`📝 Processing ${rows.length - 1} data rows from Google Sheets...`);
                console.log('📋 Header row:', rows[0]);
                console.log('📋 First data row sample:', rows[1]);
                
                // Convert Google Sheets data to our format
                // Expected columns: TimeStamp, Name, Status
                const sheetData = rows.slice(1).map((row, index) => {
                    const timestamp = row[0] || '';
                    const name = row[1] || '';
                    const status = (row[2] || '').toLowerCase().trim();
                    
                    console.log(`🔍 Processing row ${index + 2}:`, { timestamp, name, status });
                    
                    // Parse timestamp - handle multiple formats
                    let date = '';
                    let time = '';
                    let uid = 'SHEET-' + (index + 1); // Generate unique ID for sheet records
                    
                    if (timestamp) {
                        try {
                            let dateObj;
                            
                            // Try different timestamp formats
                            if (timestamp.includes('/')) {
                                // Format: MM/DD/YYYY HH:MM:SS or DD/MM/YYYY HH:MM:SS
                                dateObj = new Date(timestamp);
                            } else if (timestamp.includes('-')) {
                                // Format: YYYY-MM-DD HH:MM:SS
                                dateObj = new Date(timestamp);
                            } else {
                                // Try parsing as-is
                                dateObj = new Date(timestamp);
                            }
                            
                            if (!isNaN(dateObj.getTime())) {
                                date = dateObj.toISOString().split('T')[0]; // YYYY-MM-DD
                                time = dateObj.toTimeString().slice(0, 5); // HH:MM
                                console.log(`✅ Parsed timestamp: ${timestamp} → Date: ${date}, Time: ${time}`);
                            } else {
                                console.warn(`⚠️ Invalid timestamp format: ${timestamp}`);
                                // Try to extract date manually if possible
                                const dateMatch = timestamp.match(/(\d{1,2})[\/\-](\d{1,2})[\/\-](\d{4})/);
                                const timeMatch = timestamp.match(/(\d{1,2}):(\d{2})/);
                                
                                if (dateMatch) {
                                    const [, month, day, year] = dateMatch;
                                    date = `${year}-${month.padStart(2, '0')}-${day.padStart(2, '0')}`;
                                    console.log(`🔧 Manually extracted date: ${date}`);
                                }
                                
                                if (timeMatch) {
                                    const [, hour, minute] = timeMatch;
                                    time = `${hour.padStart(2, '0')}:${minute}`;
                                    console.log(`🔧 Manually extracted time: ${time}`);
                                }
                            }
                        } catch (e) {
                            console.error(`❌ Error parsing timestamp "${timestamp}":`, e);
                        }
                    }
                    
                    // Normalize status values
                    let normalizedStatus = status;
                    if (status.includes('entry') || status.includes('in') || status.includes('enter')) {
                        normalizedStatus = 'entry';
                    } else if (status.includes('exit') || status.includes('out') || status.includes('leave')) {
                        normalizedStatus = 'exit';
                    } else if (status.includes('absent')) {
                        normalizedStatus = 'absent';
                    }
                    
                    const record = {
                        name: name.trim(),
                        uid: uid,
                        date: date,
                        time: time,
                        status: normalizedStatus
                    };
                    
                    console.log(`📝 Created record:`, record);
                    return record;
                }).filter(record => {
                    const isValid = record.name && record.date && record.status;
                    if (!isValid) {
                        console.warn('⚠️ Filtered out invalid record:', record);
                    }
                    return isValid;
                });
                
                console.log(`✅ Successfully processed ${sheetData.length} valid records from Google Sheets`);
                console.log('📊 Sample processed records:', sheetData.slice(0, 3));
                
                if (sheetData.length === 0) {
                    console.log('⚠️ No valid records found after processing. Using sample data.');
                    return attendanceData;
                }
                
                // Sort by date and time (most recent first)
                sheetData.sort((a, b) => {
                    const dateTimeA = new Date(`${a.date}T${a.time}`);
                    const dateTimeB = new Date(`${b.date}T${b.time}`);
                    return dateTimeB - dateTimeA;
                });
                
                console.log('🎉 Google Sheets data loaded successfully!');
                return sheetData;
                
            } catch (error) {
                console.error('❌ Error fetching Google Sheets data:', error);
                console.log('🔄 Falling back to sample data.');
                return attendanceData;
            }
        }

        // Function to refresh data
        async function refreshData() {
            console.log('🔄 Starting data refresh...');
            const loadingIndicator = document.getElementById('loadingIndicator');
            if (loadingIndicator) {
                loadingIndicator.classList.remove('hidden');
            }
            
            try {
                console.log('📊 Fetching latest attendance data...');
                const newAttendanceData = await fetchGoogleSheetsData();
                
                // Update global attendance data
                attendanceData = newAttendanceData;
                filteredData = [...attendanceData];
                
                console.log(`✅ Loaded ${attendanceData.length} attendance records`);
                
                // Update dashboard statistics
                console.log('📈 Updating dashboard statistics...');
                updateDashboardStats();
                
                // Refresh table and charts
                console.log('🔄 Refreshing table and charts...');
                applyFilters();
                updateCharts();
                
                // Update student summary dropdown
                populateStudentDropdown();
                
                console.log('🎉 Data refresh completed successfully!');
                
                // Show success message
                showTemporaryMessage(`Successfully loaded ${attendanceData.length} attendance records from Google Sheets!`, 'success');
                
            } catch (error) {
                console.error('❌ Error refreshing data:', error);
                showTemporaryMessage('Error refreshing data. Please check the console for details.', 'error');
            } finally {
                if (loadingIndicator) {
                    loadingIndicator.classList.add('hidden');
                }
            }
        }

        // Function to update dashboard statistics
        function updateDashboardStats() {
            const today = new Date().toISOString().split('T')[0];
            
            // Get unique students who have entry records today
            const presentStudentsToday = new Set();
            let lateEntries = 0;
            let earlyExits = 0;
            
            // Process today's attendance records
            attendanceData.forEach(record => {
                if (record.date === today) {
                    if (record.status === 'entry') {
                        presentStudentsToday.add(record.name);
                        // Check if entry is late (after 9:00 AM)
                        if (isLateEntry(record.time)) {
                            lateEntries++;
                        }
                    } else if (record.status === 'exit') {
                        // Check if exit is early (before 5:00 PM)
                        if (isEarlyExit(record.time)) {
                            earlyExits++;
                        }
                    }
                }
            });
            
            // Calculate statistics based on actual data
            const totalStudents = studentsData.length;
            const presentToday = presentStudentsToday.size;
            const absentToday = totalStudents - presentToday;
            
            // Update the dashboard cards
            document.querySelector('[data-stat="total"]').textContent = totalStudents.toLocaleString();
            document.querySelector('[data-stat="present"]').textContent = presentToday.toLocaleString();
            document.querySelector('[data-stat="absent"]').textContent = absentToday.toLocaleString();
            document.querySelector('[data-stat="late"]').textContent = lateEntries.toLocaleString();
            document.querySelector('[data-stat="early"]').textContent = earlyExits.toLocaleString();
            
            console.log(`📊 Dashboard Stats Updated - Total: ${totalStudents}, Present: ${presentToday}, Absent: ${absentToday}, Late: ${lateEntries}, Early: ${earlyExits}`);
        }

        // Set current date
        document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
            weekday: 'long',
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });

        // Navigation functionality
        let currentView = 'dashboard';
        
        function showView(viewName) {
            // Hide all views
            document.getElementById('dashboardView').style.display = 'none';
            document.getElementById('attendanceView').style.display = 'none';
            document.getElementById('studentsView').style.display = 'none';
            document.getElementById('reportsView').style.display = 'none';
            document.getElementById('settingsView').style.display = 'none';
            
            // Show selected view
            document.getElementById(viewName + 'View').style.display = 'block';
            currentView = viewName;
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('bg-blue-600', 'text-white');
                item.classList.add('text-gray-700');
            });
            
            document.querySelector(`[data-view="${viewName}"]`).classList.add('bg-blue-600', 'text-white');
            document.querySelector(`[data-view="${viewName}"]`).classList.remove('text-gray-700');
        }

        // Sidebar toggle functionality
        const sidebarToggle = document.getElementById('sidebarToggle');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');

        sidebarToggle.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            sidebarOverlay.classList.toggle('hidden');
        });

        sidebarOverlay.addEventListener('click', () => {
            sidebar.classList.add('-translate-x-full');
            sidebarOverlay.classList.add('hidden');
        });

        // Populate attendance table
        function populateTable(data) {
            const tableBody = document.getElementById('attendanceTable');
            tableBody.innerHTML = '';

            data.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-dark-700';
                
                let statusClass, statusIcon;
                if (record.status === 'entry') {
                    statusClass = 'status-entry';
                    statusIcon = 'fa-sign-in-alt';
                } else if (record.status === 'exit') {
                    statusClass = 'status-exit';
                    statusIcon = 'fa-sign-out-alt';
                } else if (record.status === 'absent') {
                    statusClass = 'text-red-600 dark:text-red-400';
                    statusIcon = 'fa-times-circle';
                }
                
                row.innerHTML = `
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900 dark:text-white">${record.name}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300 hidden sm:table-cell">${record.uid}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${record.date}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${record.time}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm">
                        <span class="inline-flex items-center space-x-1 ${statusClass}">
                            <i class="fas ${statusIcon} text-xs sm:text-sm"></i>
                            <span class="capitalize font-medium">${record.status}</span>
                        </span>
                    </td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm">
                        <button onclick="editAttendanceRecord(${index})" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1 sm:p-2 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20" title="Edit Record">
                            <i class="fas fa-edit text-xs sm:text-sm"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Filter functionality
        function applyFilters() {
            const dateFilter = document.getElementById('dateFilter').value;
            const nameFilter = document.getElementById('nameFilter').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;

            filteredData = attendanceData.filter(record => {
                const matchesDate = !dateFilter || record.date === dateFilter;
                const matchesName = !nameFilter || record.name.toLowerCase().includes(nameFilter);
                const matchesStatus = !statusFilter || record.status === statusFilter;
                
                return matchesDate && matchesName && matchesStatus;
            });

            populateTable(filteredData);
        }

        // Chart instances for updating
        let dailyChart, monthlyChart;

        // Function to update charts with new data
        function updateCharts() {
            if (dailyChart && monthlyChart) {
                // Calculate new chart data based on current attendance data
                const dailyData = calculateDailyAttendance();
                const monthlyData = calculateMonthlyAttendance();
                
                dailyChart.data.datasets[0].data = dailyData;
                monthlyChart.data.datasets[0].data = monthlyData;
                
                dailyChart.update();
                monthlyChart.update();
            }
        }

        // Calculate daily attendance percentages
        function calculateDailyAttendance() {
            // This is a simplified calculation - you can enhance based on your needs
            return [87, 92, 89, 94, 88, 76, 82]; // Sample data
        }

        // Calculate monthly attendance percentages
        function calculateMonthlyAttendance() {
            // This is a simplified calculation - you can enhance based on your needs
            return [89, 91, 87, 93, 90, 88]; // Sample data
        }

        // Add event listeners for filters
        document.getElementById('dateFilter').addEventListener('change', applyFilters);
        document.getElementById('nameFilter').addEventListener('input', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);

        // Refresh data functionality
        document.getElementById('refreshData').addEventListener('click', refreshData);

        // Sorting functionality
        let currentSort = { column: null, direction: 'asc' };
        let currentStudentSort = { column: null, direction: 'asc' };
        
        function sortTable(column) {
            // Toggle direction if same column, otherwise start with ascending
            if (currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }
            
            // Reset all sort icons
            document.querySelectorAll('[id$="Sort"]').forEach(icon => {
                icon.className = 'fas fa-sort text-gray-400';
            });
            
            // Update current column sort icon
            const sortIcon = document.getElementById(column + 'Sort');
            if (currentSort.direction === 'asc') {
                sortIcon.className = 'fas fa-sort-up text-blue-600';
            } else {
                sortIcon.className = 'fas fa-sort-down text-blue-600';
            }
            
            // Sort the data
            filteredData.sort((a, b) => {
                let valueA = a[column];
                let valueB = b[column];
                
                // Handle different data types
                if (column === 'date') {
                    valueA = new Date(valueA);
                    valueB = new Date(valueB);
                } else if (column === 'time') {
                    // Convert time to comparable format
                    valueA = valueA.replace(':', '');
                    valueB = valueB.replace(':', '');
                } else {
                    // Convert to lowercase for case-insensitive sorting
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                }
                
                if (valueA < valueB) {
                    return currentSort.direction === 'asc' ? -1 : 1;
                }
                if (valueA > valueB) {
                    return currentSort.direction === 'asc' ? 1 : -1;
                }
                return 0;
            });
            
            populateTable(filteredData);
        }

        // Students table sorting functionality
        function sortStudentsTable(column) {
            // Toggle direction if same column, otherwise start with ascending
            if (currentStudentSort.column === column) {
                currentStudentSort.direction = currentStudentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentStudentSort.column = column;
                currentStudentSort.direction = 'asc';
            }
            
            // Reset all student sort icons
            document.querySelectorAll('[id^="student"][id$="Sort"]').forEach(icon => {
                icon.className = 'fas fa-sort text-gray-400';
            });
            
            // Update current column sort icon
            const sortIcon = document.getElementById('student' + column.charAt(0).toUpperCase() + column.slice(1) + 'Sort');
            if (sortIcon) {
                if (currentStudentSort.direction === 'asc') {
                    sortIcon.className = 'fas fa-sort-up text-blue-600';
                } else {
                    sortIcon.className = 'fas fa-sort-down text-blue-600';
                }
            }
            
            // Sort the students data
            studentsData.sort((a, b) => {
                let valueA = a[column];
                let valueB = b[column];
                
                // Convert to lowercase for case-insensitive sorting
                valueA = valueA.toString().toLowerCase();
                valueB = valueB.toString().toLowerCase();
                
                if (valueA < valueB) {
                    return currentStudentSort.direction === 'asc' ? -1 : 1;
                }
                if (valueA > valueB) {
                    return currentStudentSort.direction === 'asc' ? 1 : -1;
                }
                return 0;
            });
            
            populateStudentsTable(studentsData);
        }

        // Export functionality
        document.getElementById('exportCSV').addEventListener('click', () => {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Name,UID,Date,Time,Status\n"
                + filteredData.map(row => `${row.name},${row.uid},${row.date},${row.time},${row.status}`).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "attendance_records.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        document.getElementById('exportPDF').addEventListener('click', () => {
            exportToPDF();
        });

        // PDF Export Function
        function exportToPDF() {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Add header with logo and title
                doc.setFontSize(20);
                doc.setTextColor(40, 40, 40);
                doc.text('Chaitanya Shree Academy', 20, 20);
                
                doc.setFontSize(14);
                doc.setTextColor(100, 100, 100);
                doc.text('RFID Attendance Management System', 20, 30);
                
                doc.setFontSize(12);
                doc.text('Attendance Report', 20, 40);
                doc.text(`Generated on: ${new Date().toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })}`, 20, 50);
                
                // Add summary statistics
                const totalRecords = filteredData.length;
                const uniqueStudents = new Set(filteredData.map(r => r.name)).size;
                const entryRecords = filteredData.filter(r => r.status === 'entry').length;
                const exitRecords = filteredData.filter(r => r.status === 'exit').length;
                const absentRecords = filteredData.filter(r => r.status === 'absent').length;
                
                doc.setFontSize(10);
                doc.setTextColor(60, 60, 60);
                doc.text(`Total Records: ${totalRecords}`, 20, 65);
                doc.text(`Unique Students: ${uniqueStudents}`, 20, 72);
                doc.text(`Entry Records: ${entryRecords}`, 100, 65);
                doc.text(`Exit Records: ${exitRecords}`, 100, 72);
                doc.text(`Absent Records: ${absentRecords}`, 160, 65);
                
                // Prepare table data
                const tableData = filteredData.map(record => [
                    record.name,
                    record.uid,
                    record.date,
                    record.time,
                    record.status.charAt(0).toUpperCase() + record.status.slice(1)
                ]);
                
                // Add table
                doc.autoTable({
                    head: [['Student Name', 'UID', 'Date', 'Time', 'Status']],
                    body: tableData,
                    startY: 85,
                    styles: {
                        fontSize: 9,
                        cellPadding: 3,
                    },
                    headStyles: {
                        fillColor: [59, 130, 246],
                        textColor: 255,
                        fontStyle: 'bold'
                    },
                    alternateRowStyles: {
                        fillColor: [248, 250, 252]
                    },
                    columnStyles: {
                        0: { cellWidth: 50 }, // Name
                        1: { cellWidth: 30 }, // UID
                        2: { cellWidth: 30 }, // Date
                        3: { cellWidth: 25 }, // Time
                        4: { cellWidth: 25 }  // Status
                    },
                    didDrawCell: function(data) {
                        // Color code status cells
                        if (data.column.index === 4 && data.cell.section === 'body') {
                            const status = data.cell.text[0].toLowerCase();
                            if (status === 'entry') {
                                doc.setFillColor(16, 185, 129); // Green
                            } else if (status === 'exit') {
                                doc.setFillColor(245, 158, 11); // Orange
                            } else if (status === 'absent') {
                                doc.setFillColor(239, 68, 68); // Red
                            }
                            
                            if (status !== 'status') {
                                doc.rect(data.cell.x, data.cell.y, data.cell.width, data.cell.height, 'F');
                                doc.setTextColor(255, 255, 255);
                                doc.text(data.cell.text, data.cell.x + 2, data.cell.y + data.cell.height / 2 + 2);
                            }
                        }
                    }
                });
                
                // Add footer
                const pageCount = doc.internal.getNumberOfPages();
                for (let i = 1; i <= pageCount; i++) {
                    doc.setPage(i);
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text(`Page ${i} of ${pageCount}`, doc.internal.pageSize.width - 30, doc.internal.pageSize.height - 10);
                    doc.text('Generated by Chaitanya Shree Academy RFID System', 20, doc.internal.pageSize.height - 10);
                }
                
                // Generate filename with current date
                const filename = `attendance_report_${new Date().toISOString().split('T')[0]}.pdf`;
                
                // Save the PDF
                doc.save(filename);
                
                // Show success message
                showTemporaryMessage('PDF report generated successfully!', 'success');
                
            } catch (error) {
                console.error('Error generating PDF:', error);
                showTemporaryMessage('Error generating PDF report. Please try again.', 'error');
            }
        }
        
        // Function to show temporary messages
        function showTemporaryMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-20 right-4 px-6 py-4 rounded-lg shadow-lg z-50 max-w-sm ${
                type === 'success' 
                    ? 'bg-green-100 border border-green-300 text-green-800' 
                    : 'bg-red-100 border border-red-300 text-red-800'
            }`;
            
            messageDiv.innerHTML = `
                <div class="flex items-center space-x-3">
                    <i class="fas ${type === 'success' ? 'fa-check-circle' : 'fa-exclamation-triangle'}"></i>
                    <div class="text-sm font-medium">${message}</div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-gray-600 hover:text-gray-800">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.remove();
                }
            }, 5000);
        }

        // Initialize charts
        function initializeCharts() {
            // Daily Attendance Chart
            const dailyCtx = document.getElementById('dailyChart').getContext('2d');
            dailyChart = new Chart(dailyCtx, {
                type: 'line',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Attendance %',
                        data: [87, 92, 89, 94, 88, 76, 82],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            min: 0,
                            ticks: {
                                stepSize: 10,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 4
                        }
                    }
                }
            });

            // Monthly Trends Chart
            const monthlyCtx = document.getElementById('monthlyChart').getContext('2d');
            monthlyChart = new Chart(monthlyCtx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Average Attendance',
                        data: [89, 91, 87, 93, 90, 88],
                        backgroundColor: '#10b981',
                        borderRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            min: 0,
                            ticks: {
                                stepSize: 10,
                                callback: function(value) {
                                    return value + '%';
                                }
                            }
                        }
                    },
                    elements: {
                        point: {
                            radius: 4
                        }
                    }
                }
            });
        }

        // Add Student Form Handler
        document.getElementById('addStudentForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const studentName = document.getElementById('studentName').value.trim();
            const studentId = document.getElementById('studentId').value.trim();
            const studentClass = document.getElementById('studentClass').value.trim();
            const studentStatus = document.getElementById('studentStatus').value;
            
            if (!studentName) {
                showMessage('Please enter a student name.', 'error');
                return;
            }
            
            const studentData = {
                name: studentName,
                studentId: studentId || 'AUTO-' + Date.now(),
                class: studentClass || 'Not Specified',
                status: studentStatus,
                dateAdded: new Date().toISOString().split('T')[0]
            };
            
            // Show loading state
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> <span>Adding...</span>';
            submitButton.disabled = true;
            
            try {
                const result = await addStudentToSheet(studentData);
                
                if (result.success) {
                    showMessage(result.message, 'success', 'addStudentMessage');
                    // Clear form
                    document.getElementById('addStudentForm').reset();
                    // Refresh students list
                    populateStudentsTable(studentsData);
                    updateStudentsStats();
                } else {
                    showMessage(result.message, 'error', 'addStudentMessage');
                }
            } catch (error) {
                showMessage('An error occurred while adding the student.', 'error', 'addStudentMessage');
            } finally {
                // Restore button state
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        });

        // Refresh Students Button Handler
        document.getElementById('refreshStudents').addEventListener('click', refreshStudentsData);

        // Function to show messages
        function showMessage(message, type, elementId = 'addStudentMessage') {
            const messageDiv = document.getElementById(elementId);
            if (messageDiv) {
                messageDiv.className = `mt-4 p-4 rounded-lg ${type === 'success' ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-red-100 text-red-700 border border-red-200'}`;
                messageDiv.textContent = message;
                messageDiv.classList.remove('hidden');
                
                // Hide message after 5 seconds
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                }, 5000);
            }
        }

        // Initialize the dashboard
        async function initializeDashboard() {
            // Load initial data (will use sample data if Google Sheets not configured)
            await refreshData();
            
            // Load students data
            await refreshStudentsData();
            
            // Initialize charts
            initializeCharts();
            
            // Set up auto-refresh every 5 minutes (optional)
            setInterval(refreshData, 5 * 60 * 1000);
        }

        // Modal and form handling functions
        function editAttendanceRecord(index) {
            console.log('Editing record at index:', index);
            const record = filteredData[index] || attendanceData[index];
            if (!record) {
                console.error('Record not found at index:', index);
                return;
            }
            
            // Find the actual index in attendanceData
            const actualIndex = attendanceData.findIndex(r => 
                r.name === record.name && r.date === record.date && r.time === record.time
            );
            
            document.getElementById('editRecordIndex').value = actualIndex;
            document.getElementById('editStudentName').value = record.name;
            document.getElementById('editDate').value = record.date;
            document.getElementById('editTime').value = record.time;
            document.getElementById('editStatus').value = record.status;
            
            document.getElementById('editAttendanceModal').classList.remove('hidden');
        }

        function showAttendanceMessage(message, type, modalId) {
            const messageDiv = document.getElementById(modalId + 'Message');
            if (messageDiv) {
                messageDiv.className = `px-6 pb-6 p-4 rounded-lg ${type === 'success' ? 'bg-green-100 text-green-700 border border-green-200' : 'bg-red-100 text-red-700 border border-red-200'}`;
                messageDiv.textContent = message;
                messageDiv.classList.remove('hidden');
                
                setTimeout(() => {
                    messageDiv.classList.add('hidden');
                }, 5000);
            }
        }

        // Modal event listeners
        document.getElementById('addAttendanceRecord').addEventListener('click', () => {
            // Set default values
            document.getElementById('addDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('addTime').value = new Date().toTimeString().slice(0, 5);
            document.getElementById('addAttendanceModal').classList.remove('hidden');
        });

        document.getElementById('cancelEdit').addEventListener('click', () => {
            document.getElementById('editAttendanceModal').classList.add('hidden');
        });

        document.getElementById('cancelAdd').addEventListener('click', () => {
            document.getElementById('addAttendanceModal').classList.add('hidden');
        });

        // Edit attendance form handler
        document.getElementById('editAttendanceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const index = parseInt(document.getElementById('editRecordIndex').value);
            const recordData = {
                name: document.getElementById('editStudentName').value.trim(),
                uid: attendanceData[index].uid, // Keep original UID
                date: document.getElementById('editDate').value,
                time: document.getElementById('editTime').value,
                status: document.getElementById('editStatus').value
            };
            
            if (!recordData.name || !recordData.date || !recordData.time) {
                showAttendanceMessage('Please fill in all required fields.', 'error', 'editAttendance');
                return;
            }
            
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Updating...';
            submitButton.disabled = true;
            
            try {
                const result = await updateAttendanceRecord(index, recordData);
                
                if (result.success) {
                    showAttendanceMessage(result.message, 'success', 'editAttendance');
                    // Refresh the filtered data and table
                    applyFilters();
                    updateDashboardStats();
                    setTimeout(() => {
                        document.getElementById('editAttendanceModal').classList.add('hidden');
                    }, 2000);
                } else {
                    showAttendanceMessage(result.message, 'error', 'editAttendance');
                }
            } catch (error) {
                showAttendanceMessage('An error occurred while updating the record.', 'error', 'editAttendance');
            } finally {
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        });

        // Add attendance form handler
        document.getElementById('addAttendanceForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const recordData = {
                name: document.getElementById('addStudentName').value.trim(),
                uid: 'AUTO',
                date: document.getElementById('addDate').value,
                time: document.getElementById('addTime').value,
                status: document.getElementById('addStatus').value
            };
            
            if (!recordData.name || !recordData.date || !recordData.time) {
                showAttendanceMessage('Please fill in all required fields.', 'error', 'addAttendance');
                return;
            }
            
            const submitButton = e.target.querySelector('button[type="submit"]');
            const originalText = submitButton.innerHTML;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Adding...';
            submitButton.disabled = true;
            
            try {
                const result = await addAttendanceRecord(recordData);
                
                if (result.success) {
                    showAttendanceMessage(result.message, 'success', 'addAttendance');
                    document.getElementById('addAttendanceForm').reset();
                    // Set default values again for next use
                    document.getElementById('addDate').value = new Date().toISOString().split('T')[0];
                    document.getElementById('addTime').value = new Date().toTimeString().slice(0, 5);
                    // Refresh the filtered data and table
                    applyFilters();
                    updateDashboardStats();
                    setTimeout(() => {
                        document.getElementById('addAttendanceModal').classList.add('hidden');
                    }, 2000);
                } else {
                    showAttendanceMessage(result.message, 'error', 'addAttendance');
                }
            } catch (error) {
                showAttendanceMessage('An error occurred while adding the record.', 'error', 'addAttendance');
            } finally {
                submitButton.innerHTML = originalText;
                submitButton.disabled = false;
            }
        });

        // Delete record handler
        document.getElementById('deleteRecord').addEventListener('click', async function() {
            if (!confirm('Are you sure you want to delete this attendance record? This action cannot be undone.')) {
                return;
            }
            
            const index = parseInt(document.getElementById('editRecordIndex').value);
            
            const button = this;
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            button.disabled = true;
            
            try {
                const result = await deleteAttendanceRecord(index);
                
                if (result.success) {
                    showAttendanceMessage(result.message, 'success', 'editAttendance');
                    // Refresh the filtered data and table
                    applyFilters();
                    updateDashboardStats();
                    setTimeout(() => {
                        document.getElementById('editAttendanceModal').classList.add('hidden');
                    }, 2000);
                } else {
                    showAttendanceMessage(result.message, 'error', 'editAttendance');
                }
            } catch (error) {
                showAttendanceMessage('An error occurred while deleting the record.', 'error', 'editAttendance');
            } finally {
                button.innerHTML = originalText;
                button.disabled = false;
            }
        });

        // Close modals when clicking outside
        document.getElementById('editAttendanceModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        document.getElementById('addAttendanceModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });

        // College timing configuration
        const COLLEGE_TIMINGS = {
            startTime: '08:30',
            endTime: '17:00',
            lateThreshold: '09:00'
        };

        // Function to check if entry is late
        function isLateEntry(time) {
            return time > COLLEGE_TIMINGS.lateThreshold;
        }

        // Function to check if exit is early
        function isEarlyExit(time) {
            return time < COLLEGE_TIMINGS.endTime;
        }
        
        // End of Day Report Functions
        function generateEndOfDayReport(selectedDate) {
            const reportDate = selectedDate || new Date().toISOString().split('T')[0];
            
            // Get all students
            const allStudents = studentsData.map(s => s.name);
            
            // Get attendance records for the selected date
            const dayRecords = attendanceData.filter(record => record.date === reportDate);
            
            // Categorize students
            const studentsWithEntry = new Set();
            const studentsWithExit = new Set();
            const studentsWithCompleteAttendance = [];
            const studentsWithEntryOnly = [];
            const studentsWithNoEntry = [];
            
            // Process records to find entry and exit patterns
            dayRecords.forEach(record => {
                if (record.status === 'entry') {
                    studentsWithEntry.add(record.name);
                } else if (record.status === 'exit') {
                    studentsWithExit.add(record.name);
                }
            });
            
            // Categorize students based on their attendance pattern
            allStudents.forEach(studentName => {
                const hasEntry = studentsWithEntry.has(studentName);
                const hasExit = studentsWithExit.has(studentName);
                
                if (hasEntry && hasExit) {
                    studentsWithCompleteAttendance.push(studentName);
                } else if (hasEntry && !hasExit) {
                    studentsWithEntryOnly.push(studentName);
                } else if (!hasEntry) {
                    studentsWithNoEntry.push(studentName);
                }
            });
            
            // Update the UI
            document.getElementById('dayReportContent').classList.remove('hidden');
            document.getElementById('noDayReportGenerated').classList.add('hidden');
            
            // Update counts
            document.getElementById('entryOnlyCount').textContent = studentsWithEntryOnly.length;
            document.getElementById('completeAttendanceCount').textContent = studentsWithCompleteAttendance.length;
            document.getElementById('noEntryCount').textContent = studentsWithNoEntry.length;
            
            // Update summary statistics
            document.getElementById('totalStudentsReport').textContent = allStudents.length;
            document.getElementById('presentStudentsReport').textContent = studentsWithCompleteAttendance.length;
            document.getElementById('incompleteStudentsReport').textContent = studentsWithEntryOnly.length;
            document.getElementById('absentStudentsReport').textContent = studentsWithNoEntry.length;
            
            // Populate student lists
            populateStudentList('entryOnlyList', studentsWithEntryOnly, 'orange');
            populateStudentList('completeAttendanceList', studentsWithCompleteAttendance, 'green');
            populateStudentList('noEntryList', studentsWithNoEntry, 'red');
            
            return {
                date: reportDate,
                total: allStudents.length,
                complete: studentsWithCompleteAttendance.length,
                entryOnly: studentsWithEntryOnly.length,
                absent: studentsWithNoEntry.length,
                studentsWithEntryOnly,
                studentsWithCompleteAttendance,
                studentsWithNoEntry
            };
        }
        
        function populateStudentList(containerId, students, colorTheme) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            if (students.length === 0) {
                container.innerHTML = '<p class="text-xs text-gray-500 dark:text-dark-400 italic">No students in this category</p>';
                return;
            }
            
            students.forEach(studentName => {
                const studentDiv = document.createElement('div');
                studentDiv.className = `flex items-center justify-between p-2 bg-white dark:bg-dark-800 rounded border text-xs`;
                
                // Find student class
                const student = studentsData.find(s => s.name === studentName);
                const studentClass = student ? student.class : 'Unknown';
                
                studentDiv.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <div class="w-2 h-2 rounded-full bg-${colorTheme}-500"></div>
                        <span class="font-medium text-gray-900 dark:text-white">${studentName}</span>
                    </div>
                    <span class="text-gray-500 dark:text-dark-400">${studentClass}</span>
                `;
                
                container.appendChild(studentDiv);
            });
        }
        
        // Attendance Records View Functions
        let filteredAttendanceRecords = [];
        let currentAttendanceSort = { column: null, direction: 'asc' };
        
        function applyAttendanceFilters() {
            const fromDate = document.getElementById('attendanceFromDate').value;
            const toDate = document.getElementById('attendanceToDate').value;
            const nameFilter = document.getElementById('attendanceNameFilter').value.toLowerCase();
            const statusFilter = document.getElementById('attendanceStatusFilter').value;
            
            filteredAttendanceRecords = attendanceData.filter(record => {
                const matchesFromDate = !fromDate || record.date >= fromDate;
                const matchesToDate = !toDate || record.date <= toDate;
                const matchesName = !nameFilter || record.name.toLowerCase().includes(nameFilter);
                const matchesStatus = !statusFilter || record.status === statusFilter;
                
                return matchesFromDate && matchesToDate && matchesName && matchesStatus;
            });
            
            populateAttendanceRecordsTable();
            updateAttendanceRecordsStats();
        }
        
        function clearAttendanceFilters() {
            document.getElementById('attendanceFromDate').value = '';
            document.getElementById('attendanceToDate').value = '';
            document.getElementById('attendanceNameFilter').value = '';
            document.getElementById('attendanceStatusFilter').value = '';
            
            filteredAttendanceRecords = [...attendanceData];
            populateAttendanceRecordsTable();
            updateAttendanceRecordsStats();
        }
        
        function populateAttendanceRecordsTable() {
            const tableBody = document.getElementById('fullAttendanceTable');
            tableBody.innerHTML = '';
            
            filteredAttendanceRecords.forEach((record, index) => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-dark-700';
                
                let statusClass, statusIcon;
                if (record.status === 'entry') {
                    statusClass = 'text-green-600 dark:text-green-400';
                    statusIcon = 'fa-sign-in-alt';
                } else if (record.status === 'exit') {
                    statusClass = 'text-orange-600 dark:text-orange-400';
                    statusIcon = 'fa-sign-out-alt';
                } else {
                    statusClass = 'text-red-600 dark:text-red-400';
                    statusIcon = 'fa-times-circle';
                }
                
                row.innerHTML = `
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-900 dark:text-white">${record.date}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900 dark:text-white">${record.name}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${record.time}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm">
                        <span class="inline-flex items-center space-x-1 ${statusClass}">
                            <i class="fas ${statusIcon}"></i>
                            <span class="capitalize font-medium">${record.status}</span>
                        </span>
                    </td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300 hidden sm:table-cell">${record.uid}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm">
                        <button onclick="editAttendanceRecord(${attendanceData.indexOf(record)})" class="text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 p-1 sm:p-2 rounded hover:bg-blue-50 dark:hover:bg-blue-900/20" title="Edit Record">
                            <i class="fas fa-edit"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Update records count
            document.getElementById('recordsCount').textContent = `Showing ${filteredAttendanceRecords.length} records`;
        }
        
        function updateAttendanceRecordsStats() {
            const totalRecords = filteredAttendanceRecords.length;
            const entryRecords = filteredAttendanceRecords.filter(r => r.status === 'entry').length;
            const exitRecords = filteredAttendanceRecords.filter(r => r.status === 'exit').length;
            const uniqueStudents = new Set(filteredAttendanceRecords.map(r => r.name)).size;
            
            document.getElementById('totalAttendanceRecords').textContent = totalRecords;
            document.getElementById('totalEntryRecords').textContent = entryRecords;
            document.getElementById('totalExitRecords').textContent = exitRecords;
            document.getElementById('uniqueStudentsCount').textContent = uniqueStudents;
        }
        
        function sortAttendanceTable(column) {
            if (currentAttendanceSort.column === column) {
                currentAttendanceSort.direction = currentAttendanceSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                currentAttendanceSort.column = column;
                currentAttendanceSort.direction = 'asc';
            }
            
            // Reset all sort icons
            document.querySelectorAll('[id^="attendance"][id$="Sort"]').forEach(icon => {
                icon.className = 'fas fa-sort text-gray-400 dark:text-dark-400';
            });
            
            // Update current column sort icon
            const sortIcon = document.getElementById('attendance' + column.charAt(0).toUpperCase() + column.slice(1) + 'Sort');
            if (sortIcon) {
                if (currentAttendanceSort.direction === 'asc') {
                    sortIcon.className = 'fas fa-sort-up text-blue-600 dark:text-blue-400';
                } else {
                    sortIcon.className = 'fas fa-sort-down text-blue-600 dark:text-blue-400';
                }
            }
            
            // Sort the data
            filteredAttendanceRecords.sort((a, b) => {
                let valueA = a[column];
                let valueB = b[column];
                
                if (column === 'date') {
                    valueA = new Date(valueA);
                    valueB = new Date(valueB);
                } else if (column === 'time') {
                    valueA = valueA.replace(':', '');
                    valueB = valueB.replace(':', '');
                } else {
                    valueA = valueA.toString().toLowerCase();
                    valueB = valueB.toString().toLowerCase();
                }
                
                if (valueA < valueB) {
                    return currentAttendanceSort.direction === 'asc' ? -1 : 1;
                }
                if (valueA > valueB) {
                    return currentAttendanceSort.direction === 'asc' ? 1 : -1;
                }
                return 0;
            });
            
            populateAttendanceRecordsTable();
        }
        
        // Reports Functions
        let reportTrendChart, reportDistributionChart;
        
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            let fromDate, toDate, title;
            
            const today = new Date();
            
            if (reportType === 'weekly') {
                // Last 7 days
                fromDate = new Date(today);
                fromDate.setDate(today.getDate() - 7);
                toDate = today;
                title = 'Weekly Report';
            } else if (reportType === 'monthly') {
                // Last 30 days
                fromDate = new Date(today);
                fromDate.setDate(today.getDate() - 30);
                toDate = today;
                title = 'Monthly Report';
            } else if (reportType === 'custom') {
                const fromDateStr = document.getElementById('reportFromDate').value;
                const toDateStr = document.getElementById('reportToDate').value;
                
                if (!fromDateStr || !toDateStr) {
                    showTemporaryMessage('Please select both from and to dates for custom report.', 'error');
                    return;
                }
                
                fromDate = new Date(fromDateStr);
                toDate = new Date(toDateStr);
                title = 'Custom Report';
            }
            
            const fromDateStr = fromDate.toISOString().split('T')[0];
            const toDateStr = toDate.toISOString().split('T')[0];
            
            // Filter attendance data for the period
            const periodRecords = attendanceData.filter(record => 
                record.date >= fromDateStr && record.date <= toDateStr
            );
            
            // Calculate report data
            const reportData = calculateReportData(periodRecords, fromDate, toDate);
            
            // Update UI
            document.getElementById('noReportGenerated').classList.add('hidden');
            document.getElementById('reportContent').classList.remove('hidden');
            
            document.getElementById('reportTitle').textContent = title;
            document.getElementById('reportPeriod').textContent = `Period: ${fromDate.toLocaleDateString()} - ${toDate.toLocaleDateString()}`;
            
            // Update statistics
            document.getElementById('reportTotalDays').textContent = reportData.totalDays;
            document.getElementById('reportAvgAttendance').textContent = reportData.avgAttendance + '%';
            document.getElementById('reportTotalRecords').textContent = reportData.totalRecords;
            document.getElementById('reportPeakDay').textContent = reportData.peakDay;
            
            // Update charts
            updateReportCharts(reportData);
            
            // Update top performers and needs attention
            updatePerformanceLists(reportData);
            
            // Update detailed table
            updateReportDetailTable(reportData);
        }
        
        function calculateReportData(records, fromDate, toDate) {
            const totalDays = Math.ceil((toDate - fromDate) / (1000 * 60 * 60 * 24));
            const totalRecords = records.length;
            
            // Calculate daily attendance
            const dailyAttendance = {};
            const studentAttendance = {};
            
            records.forEach(record => {
                // Daily attendance tracking
                if (!dailyAttendance[record.date]) {
                    dailyAttendance[record.date] = new Set();
                }
                if (record.status === 'entry') {
                    dailyAttendance[record.date].add(record.name);
                }
                
                // Student attendance tracking
                if (!studentAttendance[record.name]) {
                    studentAttendance[record.name] = {
                        presentDays: new Set(),
                        absentDays: 0,
                        lateEntries: 0,
                        class: studentsData.find(s => s.name === record.name)?.class || 'Unknown'
                    };
                }
                
                if (record.status === 'entry') {
                    studentAttendance[record.name].presentDays.add(record.date);
                    if (isLateEntry(record.time)) {
                        studentAttendance[record.name].lateEntries++;
                    }
                }
            });
            
            // Calculate average attendance
            const dailyAttendanceCounts = Object.values(dailyAttendance).map(set => set.size);
            const avgAttendance = dailyAttendanceCounts.length > 0 
                ? Math.round(dailyAttendanceCounts.reduce((a, b) => a + b, 0) / dailyAttendanceCounts.length)
                : 0;
            
            // Find peak day
            let peakDay = '-';
            let maxAttendance = 0;
            Object.entries(dailyAttendance).forEach(([date, students]) => {
                if (students.size > maxAttendance) {
                    maxAttendance = students.size;
                    peakDay = new Date(date).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                }
            });
            
            // Calculate student performance
            const studentPerformance = Object.entries(studentAttendance).map(([name, data]) => {
                const presentDays = data.presentDays.size;
                const attendancePercent = totalDays > 0 ? Math.round((presentDays / totalDays) * 100) : 0;
                
                return {
                    name,
                    class: data.class,
                    presentDays,
                    absentDays: totalDays - presentDays,
                    lateEntries: data.lateEntries,
                    attendancePercent
                };
            });
            
            // Sort by attendance percentage
            studentPerformance.sort((a, b) => b.attendancePercent - a.attendancePercent);
            
            return {
                totalDays,
                totalRecords,
                avgAttendance,
                peakDay,
                dailyAttendance,
                studentPerformance,
                dailyTrend: Object.entries(dailyAttendance).map(([date, students]) => ({
                    date,
                    count: students.size
                })).sort((a, b) => new Date(a.date) - new Date(b.date))
            };
        }
        
        function updateReportCharts(reportData) {
            // Destroy existing charts if they exist
            if (reportTrendChart) {
                reportTrendChart.destroy();
            }
            if (reportDistributionChart) {
                reportDistributionChart.destroy();
            }
            
            // Trend Chart
            const trendCtx = document.getElementById('reportTrendChart').getContext('2d');
            reportTrendChart = new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: reportData.dailyTrend.map(d => new Date(d.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
                    datasets: [{
                        label: 'Daily Attendance',
                        data: reportData.dailyTrend.map(d => d.count),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            
            // Distribution Chart
            const entryCount = reportData.totalRecords;
            const exitCount = attendanceData.filter(r => r.status === 'exit').length;
            const absentCount = reportData.totalRecords - entryCount;
            
            const distributionCtx = document.getElementById('reportDistributionChart').getContext('2d');
            reportDistributionChart = new Chart(distributionCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Entry', 'Exit', 'Absent'],
                    datasets: [{
                        data: [entryCount, exitCount, absentCount],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        function updatePerformanceLists(reportData) {
            // Top performers (top 5)
            const topPerformers = reportData.studentPerformance.slice(0, 5);
            const topPerformersDiv = document.getElementById('topPerformers');
            topPerformersDiv.innerHTML = '';
            
            topPerformers.forEach((student, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-green-50 dark:bg-green-900/20 rounded border';
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-6 h-6 bg-green-500 text-white rounded-full flex items-center justify-center text-xs font-bold">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="font-medium text-gray-900 dark:text-white text-sm">${student.name}</div>
                            <div class="text-xs text-gray-500 dark:text-dark-400">${student.class}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-green-600 dark:text-green-400">${student.attendancePercent}%</div>
                        <div class="text-xs text-gray-500 dark:text-dark-400">${student.presentDays}/${reportData.totalDays} days</div>
                    </div>
                `;
                topPerformersDiv.appendChild(div);
            });
            
            // Students needing attention (bottom 5)
            const needsAttention = reportData.studentPerformance.slice(-5).reverse();
            const needsAttentionDiv = document.getElementById('needsAttention');
            needsAttentionDiv.innerHTML = '';
            
            needsAttention.forEach(student => {
                const div = document.createElement('div');
                div.className = 'flex items-center justify-between p-3 bg-red-50 dark:bg-red-900/20 rounded border';
                div.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center">
                            <i class="fas fa-exclamation text-xs"></i>
                        </div>
                        <div>
                            <div class="font-medium text-gray-900 dark:text-white text-sm">${student.name}</div>
                            <div class="text-xs text-gray-500 dark:text-dark-400">${student.class}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="font-bold text-red-600 dark:text-red-400">${student.attendancePercent}%</div>
                        <div class="text-xs text-gray-500 dark:text-dark-400">${student.presentDays}/${reportData.totalDays} days</div>
                    </div>
                `;
                needsAttentionDiv.appendChild(div);
            });
        }
        
        function updateReportDetailTable(reportData) {
            const tableBody = document.getElementById('reportDetailTable');
            tableBody.innerHTML = '';
            
            reportData.studentPerformance.forEach(student => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50 dark:hover:bg-dark-700';
                
                let percentClass = 'text-gray-600 dark:text-dark-300';
                if (student.attendancePercent >= 90) percentClass = 'text-green-600 dark:text-green-400';
                else if (student.attendancePercent >= 70) percentClass = 'text-yellow-600 dark:text-yellow-400';
                else percentClass = 'text-red-600 dark:text-red-400';
                
                row.innerHTML = `
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-medium text-gray-900 dark:text-white">${student.name}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${student.class}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${student.presentDays}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${student.absentDays}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm text-gray-500 dark:text-dark-300">${student.lateEntries}</td>
                    <td class="px-3 sm:px-6 py-3 sm:py-4 whitespace-nowrap text-xs sm:text-sm font-bold ${percentClass}">${student.attendancePercent}%</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Initialize the dashboard
        async function initializeDashboard() {
            console.log('🚀 Initializing dashboard...');
            
            try {
                // Show loading state
                const loadingIndicator = document.getElementById('loadingIndicator');
                if (loadingIndicator) {
                    loadingIndicator.classList.remove('hidden');
                }
                
                // Load initial attendance data
                console.log('📊 Loading initial attendance data...');
                await refreshData();
                
                // Load students data
                console.log('👥 Loading students data...');
                await refreshStudentsData();
                
                // Initialize student summary functionality
                console.log('📋 Initializing student summary...');
                initializeStudentSummary();
                
                // Initialize charts
                console.log('📈 Initializing charts...');
                initializeCharts();
                
                // Set today's date as default filter
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('dateFilter').value = today;
                document.getElementById('reportDate').value = today;
                
                // Initialize attendance records view
                filteredAttendanceRecords = [...attendanceData];
                
                // Apply initial filters to show today's data
                applyFilters();
                
                console.log('✅ Dashboard initialization completed!');
                
                // Set up auto-refresh every 2 minutes for real-time updates
                console.log('⏰ Setting up auto-refresh every 2 minutes...');
                setInterval(() => {
                    console.log('🔄 Auto-refreshing data...');
                    refreshData();
                }, 2 * 60 * 1000);
                
                // Hide loading indicator
                if (loadingIndicator) {
                    loadingIndicator.classList.add('hidden');
                }
                
            } catch (error) {
                console.error('❌ Error initializing dashboard:', error);
                showTemporaryMessage('Error initializing dashboard. Please refresh the page.', 'error');
            }
        }

        // Authentication Functions
        function checkAuthentication() {
            const isAuthenticated = localStorage.getItem('adminAuthenticated');
            const authTime = localStorage.getItem('adminAuthTime');
            
            if (isAuthenticated === 'true' && authTime) {
                const currentTime = new Date().getTime();
                const storedTime = parseInt(authTime);
                const hoursPassed = (currentTime - storedTime) / (1000 * 60 * 60);
                
                // Check if less than 24 hours have passed
                if (hoursPassed < 24) {
                    return true;
                }
            }
            
            // Clear expired authentication
            localStorage.removeItem('adminAuthenticated');
            localStorage.removeItem('adminAuthTime');
            return false;
        }
        
        function authenticateUser(username, password, remember = false) {
            if (username === SUPER_ADMIN_USERNAME && password === SUPER_ADMIN_PASSWORD) {
                if (remember) {
                    localStorage.setItem('adminAuthenticated', 'true');
                    localStorage.setItem('adminAuthTime', new Date().getTime().toString());
                }
                return true;
            }
            return false;
        }
        
        function showDashboard() {
            document.getElementById('loginModal').classList.add('hidden');
            document.body.style.overflow = 'auto';
            initializeDashboard();
        }
        
        function showLoginModal() {
            document.getElementById('loginModal').classList.remove('hidden');
            document.body.style.overflow = 'hidden';
            document.getElementById('adminUsername').focus();
        }
        
        // Login Form Handler
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;
            const errorDiv = document.getElementById('loginError');
            
            if (authenticateUser(username, password, false)) {
                errorDiv.classList.add('hidden');
                showDashboard();
            } else {
                errorDiv.classList.remove('hidden');
                document.getElementById('adminUsername').value = '';
                document.getElementById('adminPassword').value = '';
                document.getElementById('adminUsername').focus();
                
                // Add shake animation to the form
                const form = document.getElementById('loginForm');
                form.style.animation = 'shake 0.5s';
                setTimeout(() => {
                    form.style.animation = '';
                }, 500);
            }
        });
        
        // Logout function
        function logout() {
            localStorage.removeItem('adminAuthenticated');
            localStorage.removeItem('adminAuthTime');
            location.reload();
        }
        
        // Logout button event listeners
        document.getElementById('logoutButton').addEventListener('click', function() {
            document.getElementById('logoutModal').classList.remove('hidden');
        });
        
        document.getElementById('confirmLogout').addEventListener('click', function() {
            logout();
        });
        
        document.getElementById('cancelLogout').addEventListener('click', function() {
            document.getElementById('logoutModal').classList.add('hidden');
        });
        
        // Close logout modal when clicking outside
        document.getElementById('logoutModal').addEventListener('click', function(e) {
            if (e.target === this) {
                this.classList.add('hidden');
            }
        });
        
        // Add shake animation CSS
        const style = document.createElement('style');
        style.textContent = `
            @keyframes shake {
                0%, 20%, 40%, 60%, 80% { transform: translateX(0); }
                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            }
        `;
        document.head.appendChild(style);
        
        // Settings functionality
        function loadSettings() {
            const savedSettings = localStorage.getItem('collegeSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                COLLEGE_TIMINGS.startTime = settings.startTime || '08:30';
                COLLEGE_TIMINGS.endTime = settings.endTime || '17:00';
                COLLEGE_TIMINGS.lateThreshold = settings.lateThreshold || '09:00';
                
                // Update form fields
                document.getElementById('collegeStartTime').value = COLLEGE_TIMINGS.startTime;
                document.getElementById('collegeEndTime').value = COLLEGE_TIMINGS.endTime;
                document.getElementById('lateThreshold').value = COLLEGE_TIMINGS.lateThreshold;
            }
        }
        
        function saveSettings() {
            const startTime = document.getElementById('collegeStartTime').value;
            const endTime = document.getElementById('collegeEndTime').value;
            const lateThreshold = document.getElementById('lateThreshold').value;
            
            if (!startTime || !endTime || !lateThreshold) {
                showTemporaryMessage('Please fill in all time fields.', 'error');
                return;
            }
            
            const settings = {
                startTime: startTime,
                endTime: endTime,
                lateThreshold: lateThreshold
            };
            
            // Update global configuration
            COLLEGE_TIMINGS.startTime = startTime;
            COLLEGE_TIMINGS.endTime = endTime;
            COLLEGE_TIMINGS.lateThreshold = lateThreshold;
            
            // Save to localStorage
            localStorage.setItem('collegeSettings', JSON.stringify(settings));
            
            // Update dashboard stats with new timings
            updateDashboardStats();
            
            showTemporaryMessage('College timing settings saved successfully!', 'success');
        }
        
        function resetSettings() {
            if (confirm('Are you sure you want to reset all settings to default values?')) {
                // Reset to default values
                COLLEGE_TIMINGS.startTime = '08:30';
                COLLEGE_TIMINGS.endTime = '17:00';
                COLLEGE_TIMINGS.lateThreshold = '09:00';
                
                // Update form fields
                document.getElementById('collegeStartTime').value = '08:30';
                document.getElementById('collegeEndTime').value = '17:00';
                document.getElementById('lateThreshold').value = '09:00';
                
                // Remove from localStorage
                localStorage.removeItem('collegeSettings');
                
                // Update dashboard stats
                updateDashboardStats();
                
                showTemporaryMessage('Settings reset to default values.', 'success');
            }
        }
        
        // Settings event listeners
        document.getElementById('saveSettings').addEventListener('click', saveSettings);
        document.getElementById('resetSettings').addEventListener('click', resetSettings);

        // Initialize authentication check
        function initializeApp() {
            if (checkAuthentication()) {
                showDashboard();
                loadSettings(); // Load saved settings
            } else {
                showLoginModal();
            }
        }
        
        // Event Listeners for New Features
        
        // End of Day Report
        document.getElementById('generateDayReport').addEventListener('click', function() {
            const selectedDate = document.getElementById('reportDate').value;
            if (!selectedDate) {
                showTemporaryMessage('Please select a date for the report.', 'error');
                return;
            }
            generateEndOfDayReport(selectedDate);
        });
        
        document.getElementById('exportDayReport').addEventListener('click', function() {
            const reportDate = document.getElementById('reportDate').value;
            if (!reportDate) {
                showTemporaryMessage('Please generate a report first.', 'error');
                return;
            }
            
            // Export end of day report as PDF
            exportEndOfDayReportPDF(reportDate);
        });
        
        // Attendance Records View
        document.getElementById('applyAttendanceFilters').addEventListener('click', applyAttendanceFilters);
        document.getElementById('clearAttendanceFilters').addEventListener('click', clearAttendanceFilters);
        
        document.getElementById('exportAttendanceRecords').addEventListener('click', function() {
            exportAttendanceRecordsCSV();
        });
        
        // Reports View
        document.getElementById('reportType').addEventListener('change', function() {
            const reportType = this.value;
            const customDateRange = document.getElementById('customDateRange');
            
            if (reportType === 'custom') {
                customDateRange.classList.remove('hidden');
            } else {
                customDateRange.classList.add('hidden');
            }
        });
        
        document.getElementById('generateReport').addEventListener('click', generateReport);
        
        document.getElementById('exportReportPDF').addEventListener('click', function() {
            exportReportPDF();
        });
        
        document.getElementById('exportReportCSV').addEventListener('click', function() {
            exportReportCSV();
        });
        
        // Auto-generate end of day report at 6 PM
        function checkForEndOfDayReport() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            
            // Check if it's 6:00 PM (18:00)
            if (currentHour === 18 && currentMinute === 0) {
                const today = now.toISOString().split('T')[0];
                document.getElementById('reportDate').value = today;
                generateEndOfDayReport(today);
                
                // Show notification
                showTemporaryMessage('End of day report has been automatically generated for today!', 'success');
            }
        }
        
        // Check every minute for end of day report
        setInterval(checkForEndOfDayReport, 60000);
        
        // Export Functions
        function exportEndOfDayReportPDF(reportDate) {
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Get report data
                const reportData = generateEndOfDayReport(reportDate);
                
                // Add header
                doc.setFontSize(20);
                doc.setTextColor(40, 40, 40);
                doc.text('Chaitanya Shree Academy', 20, 20);
                
                doc.setFontSize(14);
                doc.setTextColor(100, 100, 100);
                doc.text('End of Day Attendance Report', 20, 30);
                
                doc.setFontSize(12);
                doc.text(`Date: ${new Date(reportDate).toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                })}`, 20, 40);
                
                // Add summary statistics
                doc.setFontSize(14);
                doc.setTextColor(40, 40, 40);
                doc.text('Summary Statistics', 20, 55);
                
                doc.setFontSize(10);
                doc.setTextColor(60, 60, 60);
                doc.text(`Total Students: ${reportData.total}`, 20, 65);
                doc.text(`Complete Attendance: ${reportData.complete}`, 20, 72);
                doc.text(`Entry Only (No Exit): ${reportData.entryOnly}`, 20, 79);
                doc.text(`Absent Students: ${reportData.absent}`, 20, 86);
                
                let yPosition = 100;
                
                // Students with Complete Attendance
                if (reportData.studentsWithCompleteAttendance.length > 0) {
                    doc.setFontSize(12);
                    doc.setTextColor(16, 185, 129);
                    doc.text('Students with Complete Attendance', 20, yPosition);
                    yPosition += 10;
                    
                    doc.setFontSize(9);
                    doc.setTextColor(60, 60, 60);
                    reportData.studentsWithCompleteAttendance.forEach(student => {
                        doc.text(`• ${student}`, 25, yPosition);
                        yPosition += 6;
                    });
                    yPosition += 5;
                }
                
                // Students with Entry Only
                if (reportData.studentsWithEntryOnly.length > 0) {
                    doc.setFontSize(12);
                    doc.setTextColor(245, 158, 11);
                    doc.text('Students with Entry Only (No Exit)', 20, yPosition);
                    yPosition += 10;
                    
                    doc.setFontSize(9);
                    doc.setTextColor(60, 60, 60);
                    reportData.studentsWithEntryOnly.forEach(student => {
                        doc.text(`• ${student}`, 25, yPosition);
                        yPosition += 6;
                    });
                    yPosition += 5;
                }
                
                // Absent Students
                if (reportData.studentsWithNoEntry.length > 0) {
                    doc.setFontSize(12);
                    doc.setTextColor(239, 68, 68);
                    doc.text('Absent Students', 20, yPosition);
                    yPosition += 10;
                    
                    doc.setFontSize(9);
                    doc.setTextColor(60, 60, 60);
                    reportData.studentsWithNoEntry.forEach(student => {
                        doc.text(`• ${student}`, 25, yPosition);
                        yPosition += 6;
                    });
                }
                
                // Add footer
                doc.setFontSize(8);
                doc.setTextColor(150, 150, 150);
                doc.text('Generated by Chaitanya Shree Academy RFID System', 20, doc.internal.pageSize.height - 10);
                
                // Save the PDF
                const filename = `end_of_day_report_${reportDate}.pdf`;
                doc.save(filename);
                
                showTemporaryMessage('End of day report exported successfully!', 'success');
                
            } catch (error) {
                console.error('Error generating end of day report PDF:', error);
                showTemporaryMessage('Error generating PDF report. Please try again.', 'error');
            }
        }
        
        function exportAttendanceRecordsCSV() {
            const csvContent = "data:text/csv;charset=utf-8," 
                + "Date,Student Name,Time,Status,UID\n"
                + filteredAttendanceRecords.map(row => 
                    `${row.date},${row.name},${row.time},${row.status},${row.uid}`
                ).join("\n");
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", `attendance_records_${new Date().toISOString().split('T')[0]}.csv`);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showTemporaryMessage('Attendance records exported successfully!', 'success');
        }
        
        function exportReportPDF() {
            // Implementation for report PDF export
            showTemporaryMessage('Report PDF export functionality will be implemented.', 'success');
        }
        
        function exportReportCSV() {
            // Implementation for report CSV export
            showTemporaryMessage('Report CSV export functionality will be implemented.', 'success');
        }
        
        // Update view switching to handle attendance records
        function showView(viewName) {
            // Hide all views
            document.getElementById('dashboardView').style.display = 'none';
            document.getElementById('attendanceView').style.display = 'none';
            document.getElementById('studentsView').style.display = 'none';
            document.getElementById('reportsView').style.display = 'none';
            document.getElementById('settingsView').style.display = 'none';
            
            // Show selected view
            document.getElementById(viewName + 'View').style.display = 'block';
            currentView = viewName;
            
            // Initialize view-specific data
            if (viewName === 'attendance') {
                // Initialize attendance records view
                filteredAttendanceRecords = [...attendanceData];
                populateAttendanceRecordsTable();
                updateAttendanceRecordsStats();
            }
            
            // Update sidebar active state
            document.querySelectorAll('.sidebar-item').forEach(item => {
                item.classList.remove('bg-blue-600', 'text-white');
                item.classList.add('text-gray-700', 'dark:text-dark-300');
            });
            
            const activeItem = document.querySelector(`[data-view="${viewName}"]`);
            if (activeItem) {
                activeItem.classList.add('bg-blue-600', 'text-white');
                activeItem.classList.remove('text-gray-700', 'dark:text-dark-300');
            }
        }
        
        // Start the app when page loads
        initializeApp();
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983f0c3770eea403',t:'MTc1ODY4Mjk5Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
