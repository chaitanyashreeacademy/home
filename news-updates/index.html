<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Updates & Upcoming Events - Chaitanyashree Integrated PU College</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { font-family: 'Montserrat', sans-serif; }
        .card-hover { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.1); }
        .nav-link { transition: color 0.3s ease; }
        .nav-link:hover { color: #3b82f6; }
        .loading-spinner {
            border: 3px solid #f3f4f6;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .news-item {
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.6s ease forwards;
        }
        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .refresh-btn {
            transition: transform 0.2s ease;
        }
        .refresh-btn:hover {
            transform: rotate(180deg);
        }
        .auto-refresh-indicator {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
  <nav class="bg-white dark:bg-gray-900 shadow-lg fixed w-full top-0 z-50 transition-colors duration-200">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-16">
      <!-- Logo + Text -->
      <div class="flex items-center space-x-3">
        <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/CHAITANYA_SHREE_LOGO666_2_dc873305-f464-4839-9a1f-231a4aaa168e.png?v=1758454694"
             alt="Chaitanya Shree Academy Logo"
             class="h-12 w-auto">
        <h1 class="text-xl font-bold text-blue-900 dark:text-blue-400">Chaitanya Shree Academy</h1>
      </div>
    </div>
                <div class="hidden md:block">
                    <div class="ml-10 flex items-baseline space-x-8">
                       <a href="https://www.chaitanyashree.in/" class="nav-link text-gray-700 hover:text-blue-600 px-3 py-2 text-sm font-medium">Home</a>
                    </div>
                </div>
                <div class="md:hidden">
                    <button id="mobile-menu-btn" class="text-gray-700 hover:text-blue-600">
                        <i class="fas fa-bars text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile menu -->
        <div id="mobile-menu" class="md:hidden hidden bg-white border-t">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="https://www.chaitanyashree.in/" class="block px-3 py-2 text-gray-700 hover:text-blue-600">Home</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative bg-gradient-to-r from-blue-900 to-blue-700 text-white py-20 mt-16 overflow-hidden">
        <!-- Background Image -->
        <div class="absolute inset-0 z-0">
            <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/Blue_Modern_School_Admission_Banner_Landscape.png?v=1758456492" 
                 alt="Chaitanyashree Academy Banner" 
                 class="w-full h-full object-cover opacity-30"
                 onerror="this.style.display='none';">
            <div class="absolute inset-0 bg-gradient-to-r from-blue-900/70 to-blue-700/70"></div>
        </div>
        
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="text-center">
                <h1 class="text-4xl md:text-5xl font-bold mb-4 drop-shadow-lg">Updates & Upcoming Events</h1>
                <p class="text-xl text-blue-100 mb-8 drop-shadow-md">Stay informed about the latest news, announcements, and upcoming events at Chaitanyashree Academy</p>
                
                <!-- Live Date/Time and Refresh Button -->
                <div class="flex flex-col items-center space-y-4 mb-6">
                    <!-- Live Date and Time -->
                    <div class="bg-white/10 backdrop-blur-sm rounded-lg px-6 py-3 border border-white/20">
                        <div class="flex items-center space-x-4 text-white">
                            <div class="flex items-center">
                                <i class="fas fa-calendar-alt mr-2 text-blue-200"></i>
                                <span id="live-date" class="font-medium">Loading...</span>
                            </div>
                            <div class="w-px h-6 bg-white/30"></div>
                            <div class="flex items-center">
                                <i class="fas fa-clock mr-2 text-blue-200"></i>
                                <span id="live-time" class="font-medium">Loading...</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Manual Refresh Button -->
                    <button id="refresh-btn" class="bg-white text-blue-900 px-6 py-3 rounded-lg font-semibold hover:bg-blue-50 transition duration-300 flex items-center refresh-btn">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh Updates
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- News Content Section -->
    <section class="py-16 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Loading State -->
            <div id="loading-state" class="text-center py-12">
                <div class="loading-spinner mx-auto mb-4"></div>
                <p class="text-gray-600">Loading latest updates...</p>
            </div>

            <!-- Error State -->
            <div id="error-state" class="text-center py-12 hidden">
                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-exclamation-triangle text-2xl text-red-600"></i>
                </div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">Unable to Load Updates</h3>
                <p class="text-gray-600 mb-4">Please check your internet connection and try again.</p>
                <button onclick="loadNews()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                    Try Again
                </button>
            </div>

            <!-- News Container -->
            <div id="news-container" class="hidden">
                <div class="grid gap-8" id="news-grid">
                    <!-- News items will be dynamically loaded here -->
                </div>

                <!-- No News State -->
                <div id="no-news-state" class="text-center py-12 hidden">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-newspaper text-2xl text-blue-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">No Updates Available</h3>
                    <p class="text-gray-600">Check back later for the latest news and announcements.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Setup Instructions Modal -->
    <div id="setup-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg p-8 max-w-2xl mx-4 max-h-96 overflow-y-auto">
            <h2 class="text-2xl font-bold text-gray-900 mb-4">Google Sheets Setup Required</h2>
            <div class="space-y-4 text-sm text-gray-600">
                <p><strong>Step 1:</strong> Create a new Google Sheet with these columns:</p>
                <div class="bg-gray-100 p-3 rounded font-mono text-xs">
                    Date | Title | Description | Image_URL | Download_Link
                </div>
                
                <p><strong>Step 2:</strong> Go to Extensions → Apps Script in your Google Sheet</p>
                
                <p><strong>Step 3:</strong> Replace the default code with the provided script</p>
                
                <p><strong>Step 4:</strong> Deploy as web app and get the URL</p>
                
                <p><strong>Step 5:</strong> Replace the GOOGLE_SHEETS_URL in this page's code</p>
            </div>
            <div class="mt-6 flex justify-end">
                <button onclick="closeSetupModal()" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                    Got it!
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white py-12">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center">
                <div class="flex items-center justify-center mb-4">
                    <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/CHAITANYA_SHREE_LOGO666_2_dc873305-f464-4839-9a1f-231a4aaa168e.png?v=1758454694" alt="Chaitanyashree Academy Logo" class="h-10 w-auto mr-3" onerror="this.style.display='none';">
                    <h3 class="text-xl font-bold">Chaitanya Shree Academy</h3>
                </div>
                <p class="text-gray-300 mb-4">Jnana Jyothi PU College - Malur</p>
                <div class="border-t border-gray-700 pt-4">
                    <p>&copy; 2025 Chaitanyashree Integrated PU College. All rights reserved.</p>
<div class="flex items-center justify-center space-x-3 text-gray-500 dark:text-gray-400">
                    <span class="text-sm">Powered by</span>
                    <a href="https://sohansoft.tech" target="_self" rel="noopener noreferrer" class="flex items-center space-x-2 hover:text-white transition-colors duration-200">
                        <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/Black_and_Red_Dragon_Gaming_Company_Logo_5.png?v=1758258967" alt="Sohan Soft Tech Logo" class="h-6 w-auto" onerror="this.style.display='none';">
                        <span class="text-sm font-medium">Sohan Soft Tech</span>
                    </a>
                </div>
                </div>
            </div>
        </div>
    </footer>
<!-- ✅ WhatsApp Popup with Live Char Count (Max 50) -->
<style>
  #whatsapp-chat {
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 9999 !important;
    font-family: Arial, sans-serif;
    display: block !important;
  }

  #whatsapp-chat .chat-button {
    background: linear-gradient(145deg, #1ebe5d, #25d366);
    width: 60px;
    height: 60px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    animation: bounceIn 0.8s ease;
    box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.3);
    position: relative;
    overflow: hidden;
  }

  #whatsapp-chat .chat-button img {
    width: 32px;
    height: 32px;
  }

  #whatsapp-chat .chat-button::after {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.4), transparent 60%);
    animation: glossySwipe 3s linear infinite;
    pointer-events: none;
  }

  #whatsapp-chat .chat-popup {
    display: none;
    position: absolute;
    bottom: 80px;
    right: 0;
    width: 260px; /* reduced width */
    max-height: 400px; /* reduced height */
    overflow: hidden;
    background: linear-gradient(135deg, rgba(0, 100, 0, 0.4), rgba(0, 0, 0, 0.6));
    backdrop-filter: blur(18px) saturate(180%);
    -webkit-backdrop-filter: blur(18px) saturate(180%);
    border: 1px solid rgba(255, 255, 255, 0.12);
    border-radius: 12px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    color: #fff;
    animation: slideUp 0.4s ease-out;
  }

  #whatsapp-chat .chat-header {
    background: rgba(0, 128, 0, 0.35);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    color: #fff;
    padding: 10px;
    display: flex;
    align-items: center;
    gap: 10px;
    position: relative;
    border-top-left-radius: 12px;
    border-top-right-radius: 12px;
    box-shadow: inset 0 -1px 0 rgba(255,255,255,0.1);
  }

  #whatsapp-chat .chat-header img {
    border-radius: 50%;
    width: 38px;
    height: 38px;
    object-fit: cover;
  }

  #whatsapp-chat .close-chat {
    position: absolute;
    top: 8px;
    right: 10px;
    font-size: 18px;
    color: white;
    cursor: pointer;
  }

  #whatsapp-chat .chat-body {
    padding: 12px;
    font-size: 14px;
    color: #fff;
  }

  #whatsapp-chat .quick-buttons {
    margin-top: 8px;
  }

  #whatsapp-chat .quick-buttons button {
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 15px;
    padding: 5px 10px;
    margin: 2px;
    cursor: pointer;
    font-size: 13px;
    color: #fff;
  }

  #whatsapp-chat .chat-footer {
    text-align: center;
    padding: 8px;
    border-top: 1px solid rgba(255, 255, 255, 0.15);
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
  }

  #whatsapp-chat .chat-footer input {
    width: 100%;
    padding: 7px 9px;
    border-radius: 8px;
    border: none;
    margin-bottom: 4px;
    font-size: 14px;
  }

  #charCount {
    font-size: 12px;
    color: #ccc;
    text-align: right;
    margin: 2px 0 4px;
  }

  #whatsapp-chat .chat-footer a {
    background: rgba(0, 255, 140, 0.15);
    color: #000;
    padding: 7px 14px;
    border-radius: 20px;
    text-decoration: none;
    font-weight: bold;
    display: inline-block;
    margin-top: 4px;
    border: 1px solid rgba(255, 255, 255, 0.2);
    backdrop-filter: blur(10px);
  }

  @keyframes slideUp {
    from { transform: translateY(20px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
  }

  @keyframes bounceIn {
    0% { transform: scale(0.5); opacity: 0; }
    60% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); }
  }

  @keyframes glossySwipe {
    0% { background-position: -200% center; }
    100% { background-position: 200% center; }
  }
</style>

<div id="whatsapp-chat">
  <div class="chat-button" aria-label="Open WhatsApp Chat">
    <img src="https://img.icons8.com/color/48/000000/whatsapp--v1.png" alt="Chat">
  </div>

  <div class="chat-popup" id="chatPopup">
    <div class="chat-header">
      <img src="https://cdn.shopify.com/s/files/1/0685/1900/2265/files/CHAITANYA_SHREE_LOGO666_2_dc873305-f464-4839-9a1f-231a4aaa168e.png?v=1758454694" alt="Support Agent">
      <div>
        <strong>Need Help ??</strong><br>
        Chaitanya Shree Academy
      </div>
      <span class="close-chat">×</span>
    </div>
    <div class="chat-body" id="chatMessage">
      👋 Message us and we will typically reply in less than 30 minutes, 🚀.
      <div class="quick-buttons">
        <button onclick="setQuickMessage('📝 I want admission details')">📝 Admission Enquiry</button>
        <button onclick="setQuickMessage('💸 I would like to pay fees')">💸 Pay Fees</button>
        <button onclick="setQuickMessage('❓ I need more help regarding college services')">❓ Need More Help</button>
      </div>
    </div>
    <div class="chat-footer">
      <input type="text" id="userMessage" maxlength="50" placeholder="Type your message..." />
      <div id="charCount">0 / 50</div>
      <a id="startChatBtn" href="#">Start Chat</a>
      <a id="leaveMessageBtn" href="/pages/contact" style="display:none;">Leave a Message</a>
    </div>
  </div>
</div>

<audio id="chatSound" preload="auto">
  <source src="https://www.soundjay.com/buttons/sounds/button-16.mp3" type="audio/mpeg">
</audio>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const chatPopup = document.getElementById("chatPopup");
    const sound = document.getElementById("chatSound");
    const startBtn = document.getElementById("startChatBtn");
    const leaveBtn = document.getElementById("leaveMessageBtn");
    const chatBtn = document.querySelector(".chat-button");
    const closeBtn = document.querySelector(".close-chat");
    const userMessage = document.getElementById("userMessage");
    const charCount = document.getElementById("charCount");

    const now = new Date();
    const day = now.getDay();
    const hour = now.getHours();

    let isOpen = false;
    let soundReady = false;

    function openChat(playSound = false) {
      if (isOpen) return;
      chatPopup.style.display = "block";
      isOpen = true;
      if (playSound && soundReady) sound.play().catch(() => {});
      setTimeout(() => userMessage.focus(), 100);
    }

    function closeChat() {
      chatPopup.style.display = "none";
      isOpen = false;
    }

    function updateCharCount() {
      charCount.textContent = `${userMessage.value.length} / 50`;
    }

    userMessage.addEventListener("input", updateCharCount);

    window.setQuickMessage = function (msg) {
      userMessage.value = msg;
      updateCharCount();
      userMessage.focus();
    }

    startBtn.addEventListener("click", function (e) {
      e.preventDefault();
      const msg = userMessage.value.trim() || "Hello, I need help with my order.";
      const encoded = encodeURIComponent(msg);
      window.open(`https://wa.me/918088397572?text=${encoded}`, '_blank');
      userMessage.value = "";
      updateCharCount();
      userMessage.focus();
    });

    userMessage.addEventListener("keydown", function (e) {
      if (e.key === "Enter") {
        e.preventDefault();
        startBtn.click();
      }
    });

    chatBtn.addEventListener("click", () => openChat(true));
    closeBtn.addEventListener("click", () => closeChat());

    document.addEventListener("click", function unlockSoundOnce() {
      sound.play().catch(() => {});
      soundReady = true;
      document.removeEventListener("click", unlockSoundOnce);
    });

    document.addEventListener("click", function (e) {
      if (!document.getElementById("whatsapp-chat").contains(e.target)) closeChat();
    });

    // ❌ Auto-popup disabled: removed scroll + exit intent triggers

    if (day === 0) {
      chatMessage.innerText = "📅 It's Sunday! Our team is off today. Please leave us a message and we'll reply on Monday at 9AM.";
      startBtn.style.display = "none";
      leaveBtn.style.display = "inline-block";
    } else if (hour >= 9 && hour < 20) {
      startBtn.style.display = "inline-block";
      leaveBtn.style.display = "none";
    } else {
      chatMessage.innerText = "⏰ Our Whats app chat is available from Monday to Saturday, 9 AM to 8 PM.";
      startBtn.style.display = "none";
      leaveBtn.style.display = "inline-block";
    }

    updateCharCount(); // initialize count
  });
</script>
    <script>
        // Configuration - Replace this URL with your Google Apps Script Web App URL
        const GOOGLE_SHEETS_URL = 'https://script.google.com/macros/s/AKfycby3muDRMlDgrxzl2s-n38ao4v2x6V4LgIJYwLLQoatFbPVbzPnSmKHflu9ro4F5WDU/exec';

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Mobile menu toggle
            document.getElementById('mobile-menu-btn').addEventListener('click', function() {
                const mobileMenu = document.getElementById('mobile-menu');
                mobileMenu.classList.toggle('hidden');
            });

            // Manual refresh button
            document.getElementById('refresh-btn').addEventListener('click', function() {
                loadNews();
            });

            // Start live clock
            updateLiveDateTime();
            setInterval(updateLiveDateTime, 1000);

            // Check if Google Sheets URL is configured
            if (GOOGLE_SHEETS_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                showSetupModal();
            } else {
                closeSetupModal();
                loadNews();
            }
        });

        function updateLiveDateTime() {
            const now = new Date();
            
            // Format date
            const dateOptions = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            };
            const formattedDate = now.toLocaleDateString('en-IN', dateOptions);
            
            // Format time
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: true
            };
            const formattedTime = now.toLocaleTimeString('en-IN', timeOptions);
            
            // Update the display
            document.getElementById('live-date').textContent = formattedDate;
            document.getElementById('live-time').textContent = formattedTime;
        }

        function showSetupModal() {
            document.getElementById('setup-modal').classList.remove('hidden');
            document.getElementById('loading-state').classList.add('hidden');
        }

        function closeSetupModal() {
            document.getElementById('setup-modal').classList.add('hidden');
        }

        async function loadNews() {
            const loadingState = document.getElementById('loading-state');
            const errorState = document.getElementById('error-state');
            const newsContainer = document.getElementById('news-container');
            const newsGrid = document.getElementById('news-grid');
            const noNewsState = document.getElementById('no-news-state');

            // Show loading state
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');
            newsContainer.classList.add('hidden');

            // TEST MODE: Show sample data if Google Sheets fails
            const TEST_MODE = false;
            
            if (TEST_MODE) {
                console.log('Running in TEST MODE with sample data');
                setTimeout(() => {
                    const sampleData = [
                        {
                            Date: '2025-01-15',
                            Title: 'New Admission Process Started',
                            Description: 'Applications for 2025-26 academic year are now open. Students can apply online or visit the college office during working hours.',
                            Image_URL: '',
                            Download_Link: ''
                        },
                        {
                            Date: '2025-01-10',
                            Title: 'Annual Sports Day 2025',
                            Description: 'Join us for our annual sports day celebration on January 25th, 2025. Various competitions and events will be held.',
                            Image_URL: '',
                            Download_Link: ''
                        },
                        {
                            Date: '2025-01-05',
                            Title: 'Science Exhibition Results',
                            Description: 'Congratulations to all participants of the inter-college science exhibition. Results are now available.',
                            Image_URL: '',
                            Download_Link: ''
                        }
                    ];
                    
                    loadingState.classList.add('hidden');
                    newsContainer.classList.remove('hidden');
                    noNewsState.classList.add('hidden');
                    displayNews(sampleData);
                }, 1000);
                return;
            }

            try {
                // Check if URL is configured
                if (GOOGLE_SHEETS_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL_HERE') {
                    throw new Error('Google Sheets URL not configured');
                }

                console.log('Fetching data from:', GOOGLE_SHEETS_URL);

                // Try different fetch approaches
                let response;
                try {
                    // First attempt: Standard fetch
                    response = await fetch(GOOGLE_SHEETS_URL);
                } catch (fetchError) {
                    console.log('Standard fetch failed, trying with no-cors mode');
                    // Second attempt: No-cors mode (limited but might work)
                    response = await fetch(GOOGLE_SHEETS_URL, {
                        method: 'GET',
                        mode: 'no-cors'
                    });
                }
                
                console.log('Response status:', response.status);
                console.log('Response type:', response.type);
                
                if (response.type === 'opaque') {
                    throw new Error('CORS issue: The Google Apps Script may not be properly configured for public access');
                }
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Received data:', data);
                
                // Hide loading state
                loadingState.classList.add('hidden');
                newsContainer.classList.remove('hidden');

                if (!data || data.length === 0) {
                    noNewsState.classList.remove('hidden');
                    newsGrid.innerHTML = '';
                } else {
                    noNewsState.classList.add('hidden');
                    displayNews(data.slice(0, 10)); // Show only first 10 items
                }

            } catch (error) {
                console.error('Detailed error loading news:', error);
                console.error('Error message:', error.message);
                console.error('Error stack:', error.stack);
                
                loadingState.classList.add('hidden');
                errorState.classList.remove('hidden');
                newsContainer.classList.add('hidden');
                
                // Update error message with more details and instructions
                const errorMessage = document.querySelector('#error-state p');
                const errorTitle = document.querySelector('#error-state h3');
                
                if (error.message.includes('CORS')) {
                    errorTitle.textContent = 'Google Apps Script Access Issue';
                    errorMessage.innerHTML = `
                        <strong>CORS Error:</strong> Your Google Apps Script needs to be configured for public access.<br><br>
                        <strong>Fix this by:</strong><br>
                        1. Go to your Google Apps Script<br>
                        2. Click Deploy → Manage Deployments<br>
                        3. Change "Who has access" to "Anyone"<br>
                        4. Click "Update"
                    `;
                } else if (error.message.includes('HTTP error')) {
                    errorTitle.textContent = 'Server Error';
                    errorMessage.innerHTML = `
                        <strong>Server Error:</strong> ${error.message}<br><br>
                        Please check:<br>
                        1. Your Google Apps Script URL is correct<br>
                        2. The script is deployed and published<br>
                        3. Your Google Sheet has the correct column headers
                    `;
                } else {
                    errorTitle.textContent = 'Connection Failed';
                    errorMessage.innerHTML = `
                        <strong>Connection Error:</strong> ${error.message}<br><br>
                        <strong>Common solutions:</strong><br>
                        1. Check your internet connection<br>
                        2. Verify your Google Apps Script URL<br>
                        3. Make sure the script is deployed as "Anyone" can access<br>
                        4. Try refreshing the page
                    `;
                }
            }
        }

        function displayNews(newsItems) {
            const newsGrid = document.getElementById('news-grid');
            newsGrid.innerHTML = '';

            // Sort items by date - OLDEST FIRST (earliest dates at top)
            const sortedItems = newsItems.sort((a, b) => {
                const dateA = new Date(a.Date || '1900-01-01');
                const dateB = new Date(b.Date || '1900-01-01');
                
                // Sort in ascending order (oldest dates first)
                return dateA - dateB;
            });

            sortedItems.forEach((item, index) => {
                const newsCard = createNewsCard(item, index);
                newsGrid.appendChild(newsCard);
            });
        }

        function createNewsCard(item, index) {
            const card = document.createElement('div');
            card.className = 'news-item bg-white rounded-lg shadow-lg overflow-hidden card-hover';
            card.style.animationDelay = `${index * 0.1}s`;

            const hasImage = item.Image_URL && item.Image_URL.trim() !== '';
            const hasDownload = item.Download_Link && item.Download_Link.trim() !== '';

            card.innerHTML = `
                <div class="p-6">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <div class="w-2 h-2 bg-blue-600 rounded-full mr-2"></div>
                                <span class="text-sm text-gray-500">${formatDate(item.Date)}</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-900 mb-3">${item.Title}</h3>
                        </div>
                        ${hasDownload ? `
                            <a href="${item.Download_Link}" target="_blank" rel="noopener noreferrer" 
                               class="ml-4 bg-red-600 text-white px-4 py-2 rounded-lg text-sm font-semibold hover:bg-red-700 transition duration-300 flex items-center">
                                <i class="fas fa-download mr-2"></i>Download PDF
                            </a>
                        ` : ''}
                    </div>
                    
                    ${hasImage ? `
                        <div class="mb-4">
                            <img src="${item.Image_URL}" alt="${item.Title}" 
                                 class="w-full h-48 object-cover rounded-lg"
                                 onerror="this.style.display='none';">
                        </div>
                    ` : ''}
                    
                    <div class="text-gray-600 leading-relaxed">
                        ${formatDescription(item.Description)}
                    </div>
                </div>
            `;

            return card;
        }

        function formatDate(dateString) {
            if (!dateString) return 'No date';
            
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-IN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch (error) {
                return dateString;
            }
        }

        function formatDescription(description) {
            if (!description) return '';
            
            // Convert line breaks to HTML
            return description.replace(/\n/g, '<br>');
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'983f53fc829858e1',t:'MTc1ODY4NTkzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
